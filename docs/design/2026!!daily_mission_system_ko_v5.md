# 2026 Daily Mission System v5 (운영안 우선 정리본)

> 원본: `docs/design/2026!!daily_mission_system_ko.md`  
> 목적: 문서의 뒤섞인 순서/중복을 “운영 효율” 기준으로 재정렬.  
> 원칙: **중복 내용은 삭제하지 않고, v5에서 HTML 주석으로 중복 표시하여 보존**.

---

## 0) TL;DR (운영 관점 핵심만)

- **최우선 목표**: 유저가 진입 즉시 “지금 당장 할 것”을 제공해 첫 3초 이탈을 줄이고, 미션 → 보상 → 재방문 루프를 고착화.
- **Strict Rule(2026)**: 경험치(XP)는 **입금으로만** 획득. 미션은 **직접 보상(다이아 등)** 중심으로 설계.
- **핵심 루프**: `Instant Action(즉시 성공 경험)` → `Daily/Weekly/Special 미션 진행` → `보상(다이아/티켓/연출)` → `재방문/바이럴(TMA)` → `장기 고착(Grand Cycle)`.

---

## 1) 운영 우선순위 (가장 효율적인 실행 순서)

### Phase 0. “지금 당장” 공급 (Instant Action)
1. 일일 환영 선물(원탭) + 티켓 제로 구출 루프
2. 실시간 증명(금고 적립 연출/잭팟 피드)로 “살아있는 서비스” 느낌 강화
3. 플래시 미션(타임어택)로 단기 트리거 제공

### Phase 1. 미션 시스템 코어(데일리/주간/특별) 운영 안정화
1. 미션 정의/진행/클레임 데이터 모델 확정
2. 리셋 주기(KST/UTC)와 집계 규칙 확정
3. UI(미션 보드/카드/진행바)와 API 연동

### Phase 2. 경제/락업(Grand Cycle)로 장기 고착
1. 1주:4주:12주 자산 사이클 설계
2. 체리피커 방어(레벨/승인/필터링) 운영 룰 적용

### Phase 3. TMA(텔레그램 미니앱) 특화로 바이럴/마찰 제거
1. `shareToStories`, `switchInlineQuery`, `CloudStorage` 캐싱, 햅틱
2. 봇 넛지(90% 달성 푸시) 및 Stars 결제 루프(선택)

### Phase 4. 금고/출금 운영 완성도(신뢰)
1. 출금 신청 → 관리자 승인/거절 → 정산(외부 이체) 플로우 완결
2. 만료/잠금 정책, 모니터링/리포팅 정리

### Phase 5. 성능/보안/안정화(운영 사고 방지)
1. 로딩 최적화(Lazy load, WebP, Gzip/Brotli)
2. Telegram Auth(`initData`) 강화 + 명시적 로그아웃/연결 플로우
3. 오디오 안정화(Preload/Unlock/메모리 관리)

---

## 2) Phase 0 — 콘텐츠 공백(Gap) 해소: Instant Action

> 유저가 진입했을 때 “준비 중”이 아닌 “지금 당장 할 것”을 제공하여 첫 3초의 이탈을 막습니다.

### 2.0 구현 상태(현재 코드 기준)

| 항목 | 상태 | 근거(코드) | 비고 |
| :--- | :--- | :--- | :--- |
| **일일 환영 선물(원탭)** | 부분 구현(옵션) | `src/components/layout/SidebarAppLayout.tsx` + `src/config/featureFlags.ts`( `VITE_ENABLE_TRIAL_GRANT`) / `app/api/routes/trial_grant.py` / `app/services/trial_grant_service.py` | 기본값 OFF. “원탭 받기” UI는 별도 버튼 형태로는 없음(현재는 자동 1회 지급 흐름). |
| **티켓 제로 구출 루프** | 미사용(비활성) | `src/components/game/TicketZeroPanel.tsx` | 컴포넌트가 `return null; // Feature temporarily disabled`로 비활성화되어 실제 UI가 노출되지 않음. |
| **금고 적립 연출** | 부분 구현 | `src/components/vault/VaultAccrualModal.tsx` + `src/pages/RoulettePage.tsx` / `src/pages/DicePage.tsx` / `src/pages/LotteryPage.tsx` (`vaultEarn` → toast) | “코인이 금고로 쏟아져 들어가는” 물리 애니메이션/플라잉 연출은 아님(상단 토스트+카운팅). |
| **실시간 잭팟 피드** | 미구현 | (검색 기준 관련 UI/route 없음) | “누가 방금 출금/당첨” 팝업 피드는 현재 프론트에 구현 흔적이 없음. |
| **플래시 미션(타임어택)** | 미구현 | (검색 기준 관련 모델/스케줄/UI 없음) | 시간 제한 미션 정의/집계/노출/만료 처리 전부 TODO. |

### 2.0.1 신규 유저용: “입금 + 미션” 잠금 보너스(유저당 최대 1만)

> 목표: 신규 유저에게 “지금 당장 할 것”을 주되, **돈복사/대량 계정**을 막기 위해 **입금이 없으면 단 1원도 현금화되지 않도록** 설계한다.
> 구현 방향: 기존 유저에게 노출되지 않도록 **신규 유저 전용 페이지로 분리**한다. (예: `/new-user/welcome`)
> 신규/기존 판별 기준(운영): **외부랭킹(External Ranking)의 입금 이력**을 기준으로 “기존/신규”를 구분한다. (예: `external_ranking_data.deposit_amount > 0`이면 기존)

#### Telegram 계정 ↔ 기존 계정 연동(필수)
- **문제**: Telegram Mini App 로그인 시 `telegram_id` 기준으로 user를 찾는데, 미연동 상태에서 바로 접속하면 **새 user가 생성**되어 `external_ranking_data`(입금액/횟수)가 **기존 user_id에 남아** “기존 유저가 신규로 오판”될 수 있음.
- **해결(v1)**: 기존 계정으로 로그인한 뒤 **1회성 링크 토큰(start_param)** 을 발급 → Telegram deep link(`startapp`)로 진입 → `/api/telegram/auth`에서 token을 검증해 **기존 user에 `telegram_id`를 attach** 한다.
- **보안(최소)**: 1회성 nonce + 짧은 만료(기본 10분) + 이미 `telegram_id`가 있으면 발급/연동 불가.
- **팀 공용 개발 계획/체크리스트**: `docs/02_architecture/telegram_account_linking_v1_ko.md`

#### 지급/해금 구조(운영안)
- **지급 형태**: 현금/포인트 즉시 지급 금지 → **`vault_locked_balance`(잠금 금고)로만 적립**
- **보너스 상한**: **유저당 최대 10,000**
- **입금 필수(해금 시작 조건)**: 입금 확인 전에는 잠금 보너스가 있어도 **해금(locked → cash) 불가**
- **미션 연동(해금 진행)**: 총 4개 미션(각 25%)을 완료할 때마다 잠금 보너스의 일부를 **locked → cash 이동**

#### 해금 미션(총합 100%)
1. **입금 확인(자동)**: “해금 시작” 상태만 부여 (즉시 지급 X)
2. **게임 1회 플레이**: 25% 해금
3. **게임 3회 플레이**: 25% 해금
4. **스토리 공유 OR 채널 가입**: 25% 해금
5. **다음날 재접속(출석)**: 25% 해금

> 변형안: “다음날 재접속” 대신 “당일 미션 1개 추가”로 바꿔 **당일 100% 해금**도 가능(운영 선택).

#### 악용 방지(최소 세트)
- **1회성**: 유저당 1번만(“첫 입금” 기준)
- **텔레그램 기준**: `telegram_id` 연동된 계정만 대상
- **시간 제한**: 보너스 발생 후 **24시간 내** 미션을 완료하지 못하면 **만료**

#### 운영 파라미터(초기값 제안)
- 잠금 보너스 산식(예): `min(10,000, 입금액 × R)` (권장 R=0.2, 즉 20%)
- 해금 단위: 25% 고정(= 4단계) 또는 20% (5단계)로 조정 가능

### 2.1 3초 이내의 성공 경험 (Immediate One-Tap)
- **일일 환영 선물 (Daily Instant Gift)**: 앱 진입 즉시 버튼 한 번으로 티켓/다이아 수령. (미션 보드로 유도)
- **성공 경험 선지급**: 복잡한 게임 미션 이전에 “입장 완료” 보상을 먼저 주어 유저에게 ‘진척감’ 부여.

### 2.2 “미래 정산” → “실시간 증명” (Live Proof)
- **금고 적립 연출**: 게임 승리 시 코인이 금고로 쏟아져 들어가는 시각적 효과 강화.
- **실시간 잭팟 피드**: PvP 히스토리 대신, 타 유저의 실시간 출금/당첨 소식을 상단 팝업으로 노출하여 ‘살아있는 서비스’임을 증명.

### 2.3 플래시 미션 (Flash Mission)
- **타임어택**: “지금부터 15분 내에 다이스 1판 플레이 시 2배 보상”과 같은 단기 트리거.
- **티켓 제로 구출**: 티켓이 0일 때 즉시 발동되는 ‘광고 시청’ 또는 ‘초간단 미니게임’ 루프.

### 2.4 기존 유저용: “지금 당장” 공급 (TBD)

> 기존 유저는 “신규 유저 보너스”를 그대로 주면 비용이 폭발하므로, **세그먼트/상태 기반 조건**이 필요하다.  
> (아래는 확정이 아니라 후보이며, 운영안 추가 설계 필요)

- **티켓 제로 구출**: “티켓 0”일 때만 1일 1회(또는 주 2회) 지급 + 보상은 잠금/만료(신규와 동일한 안전장치)
- **복귀 보너스**: `N일 미접속` 유저만 대상(예: 3/7/14일) + 당일 미션 1~2개 완료 시 지급
- **빈 탱크 세그먼트**: 잔액/활동이 낮은 유저(EMPTY_TANK 등)에게만 제한 지급
- **타임어택**: 특정 시간대에만 짧게 제공(동시 접속/이벤트 트래픽 유도) + 비용 상한(일간 총량) 적용

<!--
✅ DUPLICATE(원문 보존): 아래 섹션은 원문 `Part 9. 콘텐츠 정체기 해소 및 "지금 당장"의 재미`와 내용이 사실상 동일합니다.
원문에는 표현/예시가 조금 더 확장되어 있어, 중복을 삭제하지 않고 주석으로 보존합니다.

## (DUPLICATE) Part 9. 콘텐츠 정체기 해소 및 "지금 당장"의 재미 (Direct Action)

현재 시스템이 '완성형'을 지향하다 보니, 유저가 진입했을 때 **"지금 바로 할 수 있는 것"**이 부족하다는 문제를 해결합니다.

### 1. "3초 이내의 성공" (Immediate One-Tab)
- **일일 환영 보상 (Instant Gift)**: 앱 진입 시 복잡한 미션 달성 조건 없이 버튼 한 번으로 소량의 티켓이나 다이아를 즉시 지급하는 UI 배치.
- **성공 경험의 선지급**: "게임 5판" 미션을 주기 전에, "입장 완료" 미션으로 이미 보상을 한 번 주고 시작하여 '진축감'을 형성.

### 2. "미래 정산" -> "실시간 증명" (Live Proof)
- **금고 채워지는 애니메이션**: 단순 숫자가 아닌, 게임 승리 시 금고에 코인이 '쏟아져 들어가는' 비주얼 효과 강화. "나중에 주는 돈"이 아닌 "지금 내 금고에 쌓이는 내 돈"이라는 소유권 강화.
- **실시간 잭팟 피드**: PvP 히스토리 대신, "누구가 방금 금고에서 5만 포인트를 출금 신청했습니다!"라는 시스템 알림 팝업을 상단에 띄워 '실제로 돌아가는 판'임을 증명.

### 3. "플래시 미션" (Flash Mission)
- **10분 타임어택**: "지금부터 10분 내에 다이스 1판 플레이 시 티켓 3장!"과 같은 짧은 주기의 트리거형 콘텐츠 도입.
- **유령 시간대 방어**: 접속자 수가 적은 시간대에 자동으로 발동되는 '피크타임 부스터' 연동.

### 4. 체감형 콘텐츠 갭 보완
- **미션 = 게임화**: 미션 리스트를 단순 체크리스트가 아닌, '지도' 형태나 '스탬프 북'처럼 시각적으로 즐거운 경험으로 리팩토링.
- **티켓 제로 구출의 게임화**: 티켓이 없을 때 광고를 보는 대신, 봇과의 간단한 가위바위보 등을 통해 티켓을 얻는 '미니 콘텐츠' 추가.
-->

---

## 3) Phase 1 — 데일리 미션 시스템 코어

### 3.1 핵심 카테고리
- **Daily (일일)**: 24시간마다 초기화됩니다 (KST/UTC 기준). 주로 게임 플레이 및 출석체크에 집중합니다.
- **Weekly (주간)**: 7일마다 초기화됩니다. 누적 진행 상황(예: 총 게임 횟수)에 집중합니다.
- **Special (특별)**: 1회성 또는 이벤트성 작업입니다 (예: “공식 채널 구독”, “친구 5명 초대”).

### 3.2 미션 유형 및 보상 (예시)
| 미션 명칭 | 카테고리 | 보상 | 로직 (Logic) | 상태 |
| :--- | :--- | :--- | :--- | :--- |
| **공식 채널 구독** | 특별 | 5 다이아몬드 | 텔레그램 봇 API `getChatMember`로 확인. | ? |
| **친구 5명 초대** | 특별 | 50 다이아몬드 | 추천인 링크/초대 코드를 통해 추적. | ? |
| **일일 출석 보상** | 일일 | 1 다이아몬드 | 하루 한 번 클릭으로 즉시 수령. | ? |
| **게임 5회 플레이** | 일일 | 5 다이아몬드 | 매일 카운트 초기화. | ? |
| **게임 10회 플레이** | 일일 | 10 다이아몬드 | 매일 카운트 초기화. | ? |
| **스토리에 공유** | 특별/일일 | 5 다이아몬드 | TMA `shareToStories` API 콜백을 통해 트리거. | ? |
| **게임 500회 플레이** | 주간 | 50 다이아몬드 | 일주일 동안의 누적 횟수 기반. | ? |
| **컬렉션 수집** | 특별 | ??? | 보유 아이템 인벤토리 상태 기반. | [ ] |

### 3.3 기술 아키텍처 (Backend/Frontend)

#### 백엔드 (Python/FastAPI)
- **Table: `mission`**: 미션 템플릿 정의 (제목, 보상 유형, 보상 수량, 목표 수치, 카테고리).
  - **New**: `action_type` 컬럼 추가 (“PLAY_GAME”, “LOGIN” 등) → 하나의 행동으로 여러 미션 동시 달성 지원.
- **Table: `user_mission_progress`**: 개별 사용자 진행 상황 추적 (user_id, mission_id, 현재 수치, 수령 여부, 최종 업데이트 일시).
- **Service: `MissionService`**
  - `get_available_missions(user_id)`: 현재 사용자의 진행 상황을 포함한 미션 목록 반환.
  - `update_progress(user_id, action_type, delta)`: `action_type`에 매칭되는 **모든 활성 미션**의 진행도를 일괄 업데이트.
  - `claim_reward(user_id, mission_id)`: 조건 검증 및 보상 지급 처리.

#### 프론트엔드 (React/Vite)
- **Page: `MissionPage.tsx`**: 탭 기능(전체, 일일, 주간, 특별)이 포함된 메인 대시보드.
- **Component: `MissionCard.tsx`**: 미션 아이콘, 진행 상태 바, ‘수령(Claim)’/‘시작(Start)’ 버튼 표시.
- **Frontend Integration**: Bind `MissionPage` to real API data. (TODO)
- **Verify Economy Loop**: Test Mission → Diamond → Ticket purchase flow (mock Shop). (TODO)
- **State Integration**: `missionStore` (Zustand/Context)를 사용하여 실시간 진행 상황 동기화.

### 3.4 UI/UX 고려사항
- ‘수령(Claim)’ 버튼과 ‘시작(Start)’ 버튼에 강렬하고 대비되는 색상 사용.
- 누적 작업에 대한 진행 상태 바(Progress Bar) 구현.
- 100% 완료 시 ‘수령’ 버튼 마이크로 애니메이션 추가. (Deferred)
- 보상 수령 성공 시 햅틱 피드백(`hapticFeedback`) 적용.

---

## 4) Phase 1.5 — Season Pass(레벨)과 미션의 관계 (Strict Rule 반영)

> 현재의 레벨 시스템(Season Pass)과 데일리 미션은 “유저 행동 추적/보상” 목적이 중복됩니다.  
> 다만 **2026 Strict Rule**로 인해 XP는 입금 전용이므로, 미션은 **다이아 보상 중심**으로 운영합니다.

### 4.1 통합 개념 (원문 유지)
- **기존**: 특정 행동 시 단순히 ‘스탬프’를 찍고 레벨업.
- **개선**: 개별 미션(Daily/Weekly/Special)이 스탬프 역할을 하며, 미션 완료 시 **[즉시 보상(다이아 등)]**를 획득합니다.  
  - (XP는 Strict Rule에 따라 0으로 설정 가능/또는 노출 제거)

### 4.2 통합 보상 구조 (원문 표 유지)
| 미션 유형 | 직접 보상 (예시) | 시즌 XP | 리셋 주기 |
| :--- | :--- | :--- | :--- |
| **출석체크** | 1 다이아몬드 | - | 매일 |
| **게임 5회** | 5 다이아몬드 | - | 매일 |
| **스토리 공유** | 5 다이아몬드 | - | 매일 |
| **주간 500회** | 50 다이아몬드 | - | 매주 |
| **채널 구독** | 5 다이아몬드 | - | 1회성 |

### 4.3 기대 효과(원문 요약 유지)
- 단순화: 유저가 “무엇을 해야 하는지” 한 곳(미션 보드)에서 파악 가능
- 동기부여: 미션 보상을 즉시 체감하여 몰입도 향상
- 데이터 일관성: 활동 추적 로직을 미션 엔진 하나로 통합하여 관리 효율성 증대

---

## 5) Phase 2 — 운영 전략 기반 미션 확장 (Grand Cycle)

> 단순 보상을 넘어 유저를 시스템에 장기적으로 묶어두는 락업(Lock-up) 장치.

### 5.1 자산 그랜드 사이클 (1주:4주:12주)
- **[연속] 브릿지 주간 생전 미션**: 12/25~12/31 매일 참여 시 1월 시드(30,000원) 지급. (장기 고착 시발점)
- **[누적] 월간 금고 해방**: 한 달간 미션 100회 완료 시 월간 금고(Gold) 인출 권한 +20% 해금.
- **[장기] Diamond Key 수집가**: 분기별 스페셜 미션 완수 시 Grand Vault 최종 열쇠 지급.

### 5.2 체리피커 방어 및 진성 유저 필터링
- **무제한 티켓 공급**: 신규/저레벨 유저(Lv.1~6)에게는 티켓 번들을 무제한 공급하여 활동성 확보.
- **고가치 보상 잠금(Tiered Rewards)**: Lv.7 이상의 고가치 미션은 ‘관리자 승인 대기’ 상태를 거치도록 설계하여 수동 검토 및 부정행위 방지.

---

## 6) Phase 3 — TMA(텔레그램 미니앱) 특화: Tech-Max

### 6.1 바이럴 소셜 엔진
- **스토리 공유 (`shareToStories`)**: 금고 당첨 내역 자랑 시 자동 API 검증 후 즉시 보상.
- **인라인 쿼리 초대**: 링크 복사가 아닌 연락처 리스트에서 직접 친구를 선택하는 고효율 초대 방식. (`WebApp.switchInlineQuery`)

### 6.2 네이티브 몰입 경험
- **신체적 반응 (Haptic)**: 미션 등급별 차별화된 진동 패턴 적용. (보상 수령 = 짜릿한 손맛)
- **클라우드 캐싱 (`CloudStorage`)**: 미션 상태를 로컬에 캐싱하여 서버 통신 없이 즉각적인 UI 반응 구현.

### 6.3 지능적 개입 (The “Nudge”)
- **봇 푸시 알림**: 미션 90% 달성 시(예: 9/10판) 봇이 개인 메시지로 “마지막 1판!” 넛지 발송.

### 6.4 Stars(선택) 결제 루프
- **Stars 기반 미션 부스트**: ‘즉시 완료’ 또는 24시간 ‘부스터’ 등 원탭 결제 루프(선택적으로 도입).

<!--
✅ DUPLICATE(원문 보존): 아래는 원문에 Tech-Max 섹션이 두 번 등장(Part 2/Part 5)하는 중복 본문입니다.
v5에서는 위 6장(Tech-Max)을 “정본”으로 보고, 중복 본문을 주석으로 보존합니다.

## (DUPLICATE) Part 2. TMA 특화 기술 통합 (Tech-Max)
텔레그램의 네이티브 기능을 활용하여 앱의 빠릿함과 바이럴 동력을 확보합니다.

### 1. 바이럴 소셜 엔진
- **스토리 공유 (`shareToStories`)**: 금고 당첨 내역 자랑 시 자동 API 검증 후 즉시 보상.
- **인라인 쿼리 초대**: 링크 복사가 아닌 연락처 리스트에서 직접 친구를 선택하는 고효율 초대 방식.

### 2. 네이티브 몰입 경험
- **신체적 반응 (Haptic)**: 미션 등급별 차별화된 진동 패턴 적용. (보상 수령 = 짜릿한 손맛)
- **클라우드 캐싱 (`CloudStorage`)**: 미션 상태를 로컬에 캐싱하여 서버 통신 없이 즉각적인 UI 반응 구현.

### 3. 지능적 개입 (The "Nudge")
- **봇 푸시 알림**: 미션 90% 달성 시 (예: 9/10판) 봇이 개인 메시지로 “마지막 1판!” 넛지 발송.

## (DUPLICATE) Part 5. TMA 특화 기술 통합 설계 (Tech-Max)
단순한 웹 기능을 넘어, 텔레그램 네이티브 기능을 극한으로 활용하여 유저를 앱에 고착시키고 소셜 확산을 유도합니다.

### 1. 바이럴 소셜 미션 (내장형 성장 동력)
- **“나의 스토리에 공유”**: `WebApp.shareToStories(media_url, text)` 활용. 유저가 자신의 100k+ 금고 당첨 내역을 자랑하면, API 콜백으로 확인 후 즉시 미션 보상 지급.
- **“인라인 쿼리를 통한 직접 초대”**: 단순히 링크를 복사하는 대신, `WebApp.switchInlineQuery`를 통해 연락처 목록에서 친구를 직접 선택하여 초대하도록 유도. 이는 훨씬 높은 전환율을 보장합니다.

### 2. 신체적·촉각적 몰입 (Taptic Engagement)
- **“폰 흔들어서 주사위 던지기” 미션**: 특정 고난이도 미션에서 버튼 대신 스마트폰의 가속도계(`Accelerometer`)를 감지하여 실제 주사위를 던지는 물리 액션 요구.
- **프리미엄 햅틱 피드백**: 미션 등급에 따라 다른 진동 패턴(`HapticFeedback`) 적용. “보상 수령 = 짜릿한 손맛”이라는 뇌 회로 형성.

### 3. 봇 가이드를 통한 지속적 개입 (The "Nudge")
- **미션 진행 알림 푸시**: 유저가 미션의 90%를 달성했을 때(예: 게임 9/10회), **텔레그램 봇**이 개인 메시지를 발송: *“1판만 더 하면 10 다이아 수령 가능! 지금 바로 입장하기”* (딥링크 활용).
- **실시간 그룹 채팅 동기화**: 공식 텔레그램 그룹에서의 활동을 미션화. “오늘 그룹 채팅에서 메시지 5개 남기기” (봇의 `on_message` 훅으로 실시간 검증).

### 4. 제로 레이턴시 클라우드 동기화
- **`CloudStorage` API 활용**: `WebApp.CloudStorage`를 사용하여 미션의 프론트엔드 상태를 로컬에 캐싱. 서버 통신 없이도 ‘미완료 미션’ 배지나 UI 상태를 즉각 로딩하여 앱의 “빠릿함” 구현.

### 5. 텔레그램 별(Stars) 경제 생태계 연동
- **별(Stars)을 통한 미션 부스트**: 텔레그램 가상 통화인 ‘Stars’를 사용하여 어려운 미션을 ‘즉시 완료’하거나, 24시간 동안 ‘경험치 2배 부스터’ 구매 유도. 원탭(One-tap) 결제 루프 형성.

### 6. 확장된 기술 컴포넌트
- **백엔드 구조**:
  - `MissionWebhookHandler`: 텔레그램 봇 이벤트(그룹 활동, 스토리 공유 성공 등)를 수신하여 미션 데이터 업데이트.
  - `HapticService (프론트엔드)`: 미션 UI 전환과 동기화된 네이티브 진동 제어 래퍼.
-->

---

## 7) Phase 4 — 금고(Vault) / 출금 운영 플로우

### 7.1 출금 신청 이후의 플로우 (원문 유지)
- 유저 신청: `/api/vault/withdraw` 호출 → `VaultWithdrawalRequest` 생성(상태: `PENDING`) → 보유 캐시 차감.
- 현재 상태(Missing Link): 관리자가 승인하는 API(approve)가 없습니다. 따라서 DB에 요청만 쌓이고, 실제 입금 처리를 확정 짓거나 거절 시 환불해주는 로직이 작동하지 않습니다.
- 정상 플로우(To-Be): 관리자 승인 API 호출 → 상태 `APPROVED` 변경 → 외부 뱅킹 API 연동(또는 수동 이체 확인).

### 7.2 운영 체크리스트(원문 표 유지)
구분 | 항목 | 상태 | 비고
--- | --- | --- | ---
금고 (Vault) | 적립 (Win) | ? 완료 | 게임 승리 시 잠금 금액 증가 정상
금고 (Vault) | 출금 신청 | ? 완료 | 최소금액(1만) & 당일입금 체크 로직 적용됨
금고 (Vault) | 관리자 승인 | ? 완료 | 관리자 페이지(VaultRequestManager) 구현 및 연동됨
미션 (Mission) | 다이아 보상 | ? 완료 | XP 대신 다이아몬드 지급 (설계 변경 반영됨)
미션 (Mission) | 초기화 로직 | ? 확인 | 일일 데이터 베이스 초기화 및 당일 미션 수집 확인
레벨 (Level) | 입금 연동 | ? 완료 | 입금 시 XP 지급 정상
최적화 (Perf) | 로딩 성능 | ? 완료 | Lazy Load & Gzip 적용 완료
최적화 (UX) | 주사위 UI | ? 완료 | One-screen 컴팩트 리팩토링 완료
시스템 (Auth) | 로그아웃 | ? 완료 | 명시적 로그아웃 및 연결 flow 구현 완료
로직 (Logic) | 주사위 패널티 | ? 완료 | 패배 시 -50원 미수금(차감) 반영 완료

---

## 8) Phase 5 — 성능/보안/안정화(운영 품질)

### 8.1 프로젝트 최적화 및 보안(원문 핵심 유지)
#### 앱 로딩 성능 최적화
- Vite 빌드 리포트를 통한 번들 사이즈 분석
- 주요 페이지(룰렛, 주사위, CRM)에 `React.lazy`/`Suspense` 적용
- `public` 이미지 최적화(WebP 변환)
- Nginx Brotli/Gzip 압축 설정 강화

#### 로그아웃 버튼 및 플로우
- CRM 프로필 또는 헤더에 `LogoutButton` 추가
- `initData`가 있더라도 명시적 세션 제어를 위해 “로그인 필요” 화면과 “텔레그램으로 로그인” 버튼 제공

#### 게임 보상 로직 업데이트
- **변경 사항**: `GAME_EARN_DICE_LOSE_BONUS`를 **-50**으로 변경 (패배 시 금고 잔액 차감).

#### 주사위 게임 UI 리팩토링
- 세로 패딩 및 마진 축소, 컨트롤러를 애니메이션 근처로 배치하여 “한 화면(One-screen)”에 최적화된 컴팩트한 디자인 구현.

#### 텔레그램 보안 및 자동 로그인(긴급)
- 백엔드에서 `initData` 검증 강화(`app/core/telegram.py`)
- 첫 방문 유저를 위한 “환영/연결” 단계 도입(`ConnectPage.tsx`)
- “Join/Start” 확인 없이 자동 접속되는 현상 수정(봇 멤버십 체크 연동 필요)

### 8.2 오디오 사운드 안정화 및 검증책(원문 유지)
- **사운드 리소스 프리로딩(Preloading)**: 앱 로딩 시 핵심 SFX 리소스를 미리 로드(`Howl.preload: true`)
- **강력한 오디오 컨텍스트 해제(Unlock)**: 첫 사용자 터치에서 `Howler.ctx.resume()` 강제 호출
- **메모리 관리 최적화**: 재생 종료 SFX 즉시 `unload()`하여 누수/채널 점유 최소화
- **BGM/SFX 분리 처리**: BGM은 `html5: true`, SFX는 메모리 기반 재생

---

## 9) SOP — 작업 프로토콜 (Standard Operating Procedure)

모든 개발 및 배포 과정은 안정성을 위해 다음 규칙을 엄격히 준수합니다.

1. **로컬 우선 개발 (Local First)**: 모든 기능은 로컬 환경에서 먼저 구현하고 자체 검증을 완료합니다.
2. **서버 반영 5단계 사이클**:
   - **Step 1. 정보 조회 (Inquiry)**: 서버의 현재 설정, 로그, DB 상태를 정밀하게 파악합니다.
   - **Step 2. 현황 기록 (Recording)**: 파악된 정보를 문서 또는 로그에 기록하여 기준점(Baseline)을 설정합니다.
   - **Step 3. 수정 계획 수립 (Planning)**: 서버 환경에 맞춘 구체적인 셸 스크립트 또는 코드 수정안을 작성합니다.
   - **Step 4. 실행 (Execution)**: 계획된 작업을 수행합니다.
   - **Step 5. 사후 기록 (Finalizing)**: 변경 사항과 결과를 다시 기록하고 정상 작동 여부를 최종 검증합니다.

---

## 10) 로드맵(원문 기반 재정렬)

1. **[Phase 2.7] Instant Action**: 일일 환영 보상 및 금고 애니메이션 강화. (최우선)
2. **[Phase 4] Admin Control**: 고가치 미션 수동 승인 필드 및 일괄 지급 기능 추가.
3. **[Phase 5] The Nudge**: 봇 알림 연동 및 스토리 공유 검증 API 구축.

### 보류 항목(원문 유지)
- PvP 히스토리 구현: 글로벌 실시간 승패 피드(참고 이미지 기반)
- 자동 프로필 통합: 헤더에 유저 정보(이름/레벨/잔액) 포함 프로필 카드 즉시 표시
