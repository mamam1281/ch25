# 2025-12-12 변경 로그

## 백엔드/스키마
- 코어 레벨/XP 테이블 추가: `user_level_progress`, `user_level_reward_log`, `user_xp_event_log` (Alembic 20251212_0009).
- 외부랭킹 안티어뷰즈: `deposit_remainder` 컬럼 추가 (Alembic 20251212_0010), step/cap/cooldown 환경 변수(`EXTERNAL_RANKING_DEPOSIT_*`) 도입.
- (정리됨) 글로벌 코어 레벨XP(`/api/level-xp/*`, `LevelXPService`)는 현재 시즌패스 단일 기준으로 운영하여 라우터 노출을 중단.
- 게임 토큰 로그 정비: created_at isoformat, literal_column 정렬 수정(관리자 게임 토큰 API). 
- DB 복구/이름 정리: xmas_event 기준으로 로컬 복원 및 권한 부여, docker compose v2 호환 확인.

## 서비스 로직
- 외부랭킹 upsert: deposit 스텝 계산 시 remainder 누적, 일일 리셋에서 remainder 초기화, 일일 스텝 상한·쿨다운 적용.
- (레거시) 코어 레벨XP 서비스/테이블은 DB에 남을 수 있으나 UI/운영 기준에서는 사용하지 않음.
- RewardService: 순환 의존성 방지를 위해 레벨 import 지연.
- 게임 확률 조정: 룰렛/복권 등 꽝 비중 상향으로 과도 보상 완화.
- 외부랭킹 UI: 저장/삭제 후 행 유지/반영하도록 캐시 업데이트 수정.

## 문서
- [docs/level_xp_core_rewards.md](../level_xp_core_rewards.md): 코어 레벨/XP 보상안, DB/마이그레이션, 레벨 연동, 외부랭킹 안티어뷰즈 환경 변수 추가.
- [docs/team_battle_design.md](../team_battle_design.md): 미션/레벨 보상 분리 명시, 추가 개발 아이디어, 로깅/문서화 규칙 추가.
- [docs/public_chat_design.md](../public_chat_design.md): 공개 채팅 설계(24h 보존, 필터, 레이트리밋).

## 테스트
- `tests/test_external_ranking_deposit_steps.py`: 10만 단위 스텝 누적 → XP 적립/레벨 상승 검증. 컨테이너 실행 명령: `docker compose exec backend sh -c "cd /app && PYTHONPATH=/app pytest tests/test_external_ranking_deposit_steps.py"`.
