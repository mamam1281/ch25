# Admin Ranking Guide (External Data 포함)

## 목표/흐름
- 외부 플랫폼 입금/게임횟수를 관리자가 입력 → 내부 집계와 합산 → 랭킹 API 응답 → 시즌 종료 시 보상 및 로그 기록.
- 설계 참고: `docs/external_ranking_design.md`.

## 입력/집계 절차
1) 로그인: `/admin/login` (기본 `admin` 계정).
2) 외부 데이터 입력
   - UI 준비 전: 설계 문서의 외부 랭킹 테이블에 직접 INSERT/UPDATE(입금액, 게임횟수, 메모).
   - UI 준비 후: 외부 랭킹 탭에서 user_id별 값 입력/수정/삭제.
3) 집계 확인
   - `GET /admin/api/ranking/{date}` 호출 → 내부+외부 합산 랭킹 확인(200 OK).
   - 정책(입금/게임횟수 가중치, 동점 처리)이 설계대로 반영됐는지 응답 필드 검증.

## 시즌 종료 보상
- 랭킹 컷/보상 규칙 확정 후 지급 실행(관리자 스크립트/API).
- 지급 시 로그 필수: user_id, 보상 타입/값, 사유 “EXTERNAL_RANKING”, 시즌/날짜.
- 지급 후 확인: 지급 로그 테이블 조회, 필요 시 코인/포인트 지갑 변동 확인.

## 오류/운영 체크
- 404/500: 백엔드 로그(`docker compose logs backend --tail=100`), 날짜 포맷/시즌 연동 확인.
- 데이터 불일치: 외부 테이블 최신 여부, 중복 user_id 여부, 가중치/합산 규칙 확인 후 재집계.

## 체크리스트
- 외부 데이터 입력 후 `/admin/api/ranking/{date}` 200 OK.
- 시즌 종료 보상 실행 후 지급 로그 생성 확인.
- (사용자 화면이 있다면) 사용자 노출 랭킹과 관리자 집계 결과 일치.
