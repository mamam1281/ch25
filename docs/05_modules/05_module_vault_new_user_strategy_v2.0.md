# Vault(금고) 신규 유저 리텐션 전략 - 기술 설계서

- 문서 타입: 모듈(기능: FE+BE+DB)
- 버전: v2.0 (신규 유저 전용 전략 반영)
- 작성일: 2025-12-19
- 대상 독자: 기획자, 백엔드/프론트엔드 개발자

## 0. 개요 및 핵심 철학

본 문서는 신규 유저를 대상으로 한 **"손실 회피(Loss Aversion)"** 기반의 금고 시스템 설계를 다룬다.
기존의 "보상(Reward)" 개념을 **"이미 획득한 자산의 소멸 방지(Asset Protection)"** 개념으로 전환하여, 유저가 스스로 충전하고 출석하게 만드는 것이 핵심이다.

### 핵심 원칙
1.  **Endowment Effect (보유 효과):** 금고 안의 재화는 이미 유저의 것으로 인식되어야 한다.
2.  **Loss Aversion (손실 회피):** "충전하면 준다"가 아니라, "충전 안 하면 사라진다"는 공포를 자극한다.
3.  **Investment (투자):** 출석과 같은 작은 행동 투자가 누적될수록 포기하기 어렵게 만든다.

---

## 1. 금고 구조 (Immutable)

**※ 이 구조는 변경하지 않음 (확정본)**

### 1.1 골드 금고 (Gold Vault)
- **보상:** 10,000원 (꽁머니 개념)
- **미션:**
    1. CC 채널 추가
    2. 지민 공지 채널 추가
- **성격:** 진입 장벽 0, "Aha Moment" 제공용.

### 1.2 플래티넘 금고 (Platinum Vault)
- **보상:** 30,000원
- **미션:**
    1. 단일 50,000원 이상 충전
    2. 3일 출석 (출석 인정액 30,000원)
- **성격:** 실질적인 과금 유도 및 리텐션(3일) 확보 구간.

### 1.3 다이아 금고 (Diamond Vault)
- **보상:** 쿠폰 100,000원
- **미션:**
    1. 누적 충전 500,000원
- **성격:** 상위 목표 제시(Anchor) 및 고액 유저 달성감 부여.

### 1.4 완성 보너스
- **조건:** 가입 후 7일 이내 위 3개 금고 모두 클리어
- **성격:** "2/3 완료" 상태에서의 심리적 압박 장치.

---

## 2. 상세 운영 전략

### 2.1 가입 직후: "이미 받은 돈"
- **UI 메시지:** "신규 전용 금고 3종 지급 완료. 7일 후 자동 소멸."
- **상태:** 모든 금고는 **"잠김(Locked)"** 상태가 아니라 **"보관 중(Stored)"** 상태로 표시.
- **타이머:** 모든 금고 카드에 남은 시간(7일 카운트다운)을 붉은색으로 강조.

### 2.2 골드 금고: "첫 성공 강제"
- **목표:** 가입 24시간 이내 80% 이상 클리어 유도.
- **경험:** "진짜 주네?"라는 신뢰 형성.
- **액션:** 채널 추가 버튼 클릭 시 즉시 해금 연출 (화려한 이펙트).

### 2.3 플래티넘 금고: "손실 공포의 핵심"
- **카피라이팅:**
    - ❌ "충전하면 3만원 드려요"
    - ⭕ **"이미 적립된 30,000원이 3일 뒤 소멸됩니다."**
- **출석의 역할:**
    - 1일차 출석 시: "이제 2일만 더 하면 3만원 내 거." (Sunk Cost 발동)
    - 2일차 출석 시: 충전 확률 급증 구간.

### 2.4 다이아 금고: "시각적 앵커"
- **역할:** 대부분의 유저는 달성하지 못하더라도, "저기까지 갈 수 있다"는 가능성을 보여줌.
- **연출:** "50만원 충전하세요" 대신 **"현재 진행률 18%"**와 같이 게이지로 표현하여 거부감 최소화.

### 2.5 티켓 고갈 시 전략 (Ticket Zero Friction)
**"티켓이 없으면 행동이 차단된다"는 약점을 "금고 해금"으로 연결한다.**

- **기존:** 티켓 0개 → "지민이에게 문의하세요" (수동, 이탈 발생)
- **변경:** 티켓 0개 → **"잠긴 금고 확인" 모달 자동 팝업**
    - **메시지:** "티켓이 다 떨어졌지만, 금고에 **30,000원**이 보관되어 있습니다. 지금 해금하고 게임을 계속하세요."
    - **심리:** "돈을 써라"가 아니라 "네 돈을 찾아서 게임해라"로 프레임 전환.

### 2.6 초기 경험 보정 (RTP & Small Win)
**"아하 모먼트"를 앞당기기 위해 초기 플레이 경험을 설계한다.**

- **첫 5판 보정:** 신규 유저의 첫 5회 룰렛/주사위 플레이 중 최소 1회는 반드시 **"당첨(Win)"**이 발생하도록 확률 보정 (시스템적으로 보장).
- **연출:** 당첨금은 즉시 **"골드 금고"**로 적립되는 연출을 보여주어, "내 돈이 금고에 들어갔다"는 인식을 심어준다.

---

## 3. 리텐션 트리거 (알림/메시지)

시스템은 유저에게 "충전 권유"가 아닌 **"자산 소멸 경고"**를 보낸다.

### 3.1 48시간 미충전 유저
- **메시지:** "○○님, 골드 금고는 수령하셨네요. 플래티넘 금고에 보관된 30,000원이 **48시간 뒤 소멸**됩니다. 지금 확인하세요."

### 3.2 출석 2일차 유저 (위기 조장)
- **메시지:** "출석 1일 남았습니다. 지금 포기하면 확보해둔 30,000원이 즉시 사라집니다."

---

## 4. 데이터 모델 설계 (Schema)

기존 `vault_account` 구조를 확장하여 단계별 금고 상태를 관리한다.

### 4.1 `vault_status` (유저별 금고 상태)

| 컬럼 | 타입 | 설명 |
|---|---|---|
| user_id | INT | PK, FK |
| gold_status | ENUM | `LOCKED`, `UNLOCKED`, `CLAIMED`, `EXPIRED` |
| platinum_status | ENUM | `LOCKED`, `UNLOCKED`, `CLAIMED`, `EXPIRED` |
| diamond_status | ENUM | `LOCKED`, `UNLOCKED`, `CLAIMED`, `EXPIRED` |
| platinum_attendance_days | INT | 플래티넘 미션: 출석 일수 (0~3) |
| platinum_deposit_done | BOOLEAN | 플래티넘 미션: 5충 달성 여부 |
| diamond_deposit_current | INT | 다이아 미션: 누적 충전액 |
| created_at | DATETIME | 가입일 (기준일) |
| expires_at | DATETIME | 가입일 + 7일 (전체 소멸일) |

### 4.2 로직 처리
- **입금 훅 (Deposit Hook):**
    - 입금 발생 시 `diamond_deposit_current` 누적.
    - 단일 입금액 >= 50,000원 시 `platinum_deposit_done = TRUE`.
    - 조건 달성 시 해당 금고 상태를 `UNLOCKED`로 변경 및 알림 발송.
- **출석 훅 (Attendance Hook):**
    - 매일 00시(또는 기준시) 출석 체크 시 `platinum_attendance_days` 증가.
- **소멸 스케줄러:**
    - `expires_at` 도래 시 `LOCKED` 상태인 금고를 `EXPIRED`로 일괄 변경.

---

## 5. UI/UX 가이드라인

### 5.1 체크리스트
- [ ] **초기 상태:** 가입 즉시 모든 금고가 "지급 완료(잠김)" 상태로 보여야 함.
- [ ] **타이머:** 모든 금고에 "남은 시간"이 초 단위로 흘러가야 함.
- [ ] **진행률:** 다이아 금고는 금액 대신 % 게이지로 노출.
- [ ] **완성 보너스:** "2/3 완료" 문구 강조.

### 5.2 문구 가이드
- **지양:** "보상", "이벤트", "참여하세요", "충전하세요"
- **지향:** "보관 중", "적립됨", "소멸 예정", "회수 경고", "남은 시간"

---

## 7. 현재 구현 상태 분석 (2025-12-19 기준)

본 설계서(v2.0)와 현재 코드베이스 간의 차이점(Gap Analysis)을 정리한다.

### 7.1 Backend (Python/FastAPI)
- **데이터 모델 (`app/models/user.py`):**
    - 현재: `User` 테이블에 단순 `vault_balance` (총액) 필드만 존재.
    - **누락:** `vault_status` 테이블 부재. 골드/플래티넘/다이아 상태, 출석 일수, 누적 충전액 등을 저장할 공간이 없음.
- **API 스키마 (`app/schemas/vault.py`):**
    - 현재: `VaultStatusResponse`는 단순 잔액(`vault_balance`)만 반환.
    - **누락:** 각 금고별 상태(`gold_status`, `platinum_status` 등) 필드 없음.
- **비즈니스 로직 (`app/services/vault_service.py`):**
    - 현재: 신규 유저 여부 체크 후 5,000원 단순 적립(`fill_free_once`) 로직만 존재.
    - **누락:** 3단계 미션 트랙 로직, 출석 체크 연동, 입금액에 따른 단계별 해금 로직 전무.
- **입금 훅 (`app/services/admin_external_ranking_service.py`):**
    - 현재: 입금 시 1만원/5만원 단위로 `vault_balance`를 일부 차감(해금)하는 구 버전 로직 존재.
    - **수정 필요:** v2.0 전략(단일 5충, 누적 50충)에 맞춰 로직 전면 개편 필요.

### 7.2 Frontend (React/TypeScript)
- **API 클라이언트 (`src/api/vaultApi.ts`):**
    - 현재: 백엔드의 단순 잔액 조회 API(`GET /api/vault/status`)만 연결됨.
- **UI 페이지 (`src/pages/HomePage.tsx`):**
    - 현재: `useQuery`로 데이터는 가져오나, **화면에 금고 UI를 렌더링하는 코드가 없음.**
    - **누락:** 금고 대시보드(골드/플래티넘/다이아 카드), 타이머, 진행률 게이지 등 UI 전체.

### 7.3 결론 및 조치 계획
현재 시스템은 "단순 적립소" 형태이며, 기획된 "손실 회피형 3단계 금고"는 구현되지 않음.
따라서 **DB 스키마 설계부터 시작하여 백엔드 로직 → 프론트엔드 UI 순으로 순차 개발이 필요함.**

