# 2025-12-31 Admin: Key Rewards + Key Roulette Config

## Overview
관리자 UI에서 **키 보상(GOLD_KEY / DIAMOND_KEY)** 을 선택할 수 없고, 룰렛 설정에 **ticket_type(ROULETTE_COIN / GOLD_KEY / DIAMOND_KEY)** 필드가 없어 “키 전용 룰렛”을 생성/활성화할 수 없던 문제를 해결했다.  
추가로, 게임 보상으로 `reward_type=GOLD_KEY/DIAMOND_KEY`가 내려오는 경우 실제 지갑 지급이 누락되는 경로가 있어 백엔드 지급 로직을 보강했다.

## Features

### Admin UI (Frontend)
- **보상 타입 목록 확장**: 관리자 설정 폼의 `REWARD_TYPES`에 `GOLD_KEY`, `DIAMOND_KEY` 추가.
- **룰렛 설정 폼 확장**: `ticket_type` select 필드 추가(옵션: `ROULETTE_COIN`, `GOLD_KEY`, `DIAMOND_KEY`) 및 validation/payload 반영.
- **API 타입 보강**: `adminRouletteApi.ts`의 payload 타입에 `ticket_type` 반영.

### Admin API (Backend)
- **스키마 추가**: `AdminRouletteConfigBase`에 `ticket_type: str` 추가(기본값 `ROULETTE_COIN`), 허용값 검증 추가.
- **저장 로직 반영**: admin roulette create/update 시 `RouletteConfig.ticket_type` 저장하도록 반영.

### Reward Delivery (Backend)
- **키 보상 지급 경로 보완**: `RewardService.deliver()`의 토큰 지급 맵에 `GOLD_KEY`/`DIAMOND_KEY` 추가하여,
  - 룰렛/주사위/복권 등에서 `reward_type=GOLD_KEY|DIAMOND_KEY`로 설정된 보상이 내려오면 사용자 지갑(`user_game_wallet`)에 실제로 지급되도록 보장.

## Verification & Testing
- Frontend build 확인: `npm run build`
- Backend syntax 확인: `python -m compileall app`
- 키 관련 통합 테스트 추가/실행:
  - `python -m pytest -q tests/test_roulette_key_ticket.py`
    - `ticket_type=GOLD_KEY` 플레이 시 키 1개 차감 검증
    - 룰렛 보상이 `GOLD_KEY`일 때 지갑 지급(+2) 검증
- 참고: `python -m pytest -q tests`는 `tests/test_crm_marketing.py`의 수집 단계 `SystemExit`로 인해 현재 프로젝트 상태에서 전체 실행이 실패할 수 있어, 변경 범위에 대한 타깃 테스트로 검증했다.

## Notes
- “키를 뽑는” 보상 지급은 현재 구조상 관리자 설정에 따라 **룰렛/주사위/복권**에서 가능하며, 게임 외 경로로는 **미션 보상** 및 **관리자 토큰 지급**에서도 키 지급이 가능하다.

