0) 너가 추가하려는 기능을 “기능 단위”로 쪼개기
A. 코인 부족 시 “해결 경로”를 매일 바꿔서 노출

고정 CTA: 씨씨카지노 버튼(입금/이용 유도)
보조 CTA: 실장 텔레 바로가기
문구는 어드민에서 매일 수정 → 프론트에 즉시 반영

B. 티켓 0일 때 락아웃 제거
조건형 체험 티켓
오늘 첫 접속 1장 자동
텔레 채널 구독 확인 시 추가 지급 (어드민에서 on/off 및 수량)
팀 배틀 참여 중 1회 한정 지급 (어드민에서 on/off 및 수량)
금고 미리보기(보상 프리뷰)
“지금 이용하면 바로 이어서 플레이” CTA 고정 노출

1) DB/스키마: 최소 추가로 끝내는 설계
(1) app_ui_config (또는 app_config) — “문구/링크/정책” 저장
목적: 어드민 페이지에서 매일 문구를 바꾸면 프론트에 노출.
필드 예시:
key (PK, string) 예: ticket_zero_help, cta_primary_url, cta_primary_label, cta_secondary_url, trial_policy
value (TEXT/JSON)
updated_at, updated_by
추천: value를 JSON으로 하면 확장 쉬움.
예)
{
  "ticket_zero": {
    "title": "티켓이 잠깐 부족해요",
    "body": "지금 이용하면 바로 이어서 플레이 가능합니다",
    "primaryCta": {"label":"씨씨카지노 바로가기","url":"..."},
    "secondaryCta": {"label":"실장 텔레 문의","url":"..."},
    "note": "문구는 매일 변경됩니다"
  },
  "trial": {
    "daily_login_grant": {"enabled": true, "amount": 1},
    "telegram_sub_grant": {"enabled": true, "amount": 1},
    "team_battle_grant": {"enabled": true, "amount": 1}
  }
}

(2) user_grant_log — “체험 티켓 중복 지급” 방지용 로그
목적: “오늘 첫 접속 1장” 같은 1일 1회/1회 한정을 서버에서 보장하려면 로그가 필요.
필드 예시:
id PK
user_id / external_id
grant_type (ENUM/string)
TRIAL_DAILY_LOGIN
TRIAL_TELEGRAM_SUB
TRIAL_TEAM_BATTLE
token_type (예: ROULETTE_TICKET, LOTTERY_TICKET, DICE_TOKEN)
amount
grant_key (예: 2025-12-21:TRIAL_DAILY_LOGIN) ← 유니크 제약 걸기 좋음
created_at
유니크 인덱스 추천
(user_id, grant_key) unique
→ 중복 지급이 구조적으로 불가능해짐.
이미 “토큰 증감 로그 테이블(예: wallet log)”이 있다면, 거기에 grant_type/grant_key 컬럼만 추가해도 됨(더 최소 수정).

2) 백엔드 로직: 어디에 붙이는 게 최소 수정인가
너가 이미 언급한 핵심 서비스가:
app/services/game_wallet_service.py
season_pass_service.py
여기에 “체험 지급”을 얇게 추가하는 게 가장 적게 건드리는 방법이야.

(1) game_wallet_service.py
추가할 함수 2개만으로 끝내는 패턴 추천:
get_ui_config()
app_ui_config에서 ticket_zero 관련 JSON을 읽어서 반환
try_grant_trial_tokens(user, context)
context: daily_login, telegram_verified, team_battle_joined 같은 bool
user_grant_log 확인 → 가능하면 wallet에 토큰 지급 → log 기록
지급은 기존 “GRANT” 루틴을 그대로 재사용
너가 예시 로그에 GRANT/REVOKE가 이미 있으니까, 동일한 방식으로 추가.

(2) season_pass_service.py
여긴 “XP/레벨 진행”이 핵심이라, 체험 티켓이 XP에 영향 줄지 여부가 중요해.
추천: 체험 티켓으로 플레이한 판도 XP는 쌓이게 하되,
팀배틀 점수 반영/랭킹 반영은 “유효 이용자 기준”이면 가중치로 조절(너희 운영 기조 유지).

즉:
XP: OK
팀배틀 점수: 정책에 따라 (유효 이용자만 / 낮은 가중치)
이 가중치는 DB 변경 없이도,
팀배틀 집계 로직에서 is_valid_depositor_today 같은 체크를 이미 하고 있다면 거기 재사용.

3) 프론트 로직: 어디에 어떻게 붙이나 (React/Tailwind 기준)
(1) 앱 시작 시 UI Config 한번 가져오기
GET /api/ui-config (신규)
React Query나 단순 fetch로 앱 로딩에 캐시
전역 store(예: zustand)나 context에 저장

(2) “티켓 0 상태” UI를 하나의 공통 컴포넌트로 만들기
예: <TicketZeroPanel /> 또는 <LockoutPanel />
노출 조건:
룰렛/복권/주사위 버튼 영역에서 “티켓 부족” 감지 시
구성:
상단: 안내 문구(어드민에서 내려오는 문구)
중단: 금고 프리뷰(스크롤)
하단: 고정 CTA 2개
Primary: 씨씨카지노 버튼(입금 유도)
Secondary: 실장 텔레 바로가기

(3) “체험 티켓 자동 지급” 트리거 위치
프론트에서 “지급”을 직접 하지 말고,
홈 진입 시 POST /api/wallet/trial-grant 한 번 호출
서버가 알아서 “가능하면 지급/불가능하면 무시(멱등)” 하게 만들면 끝.
프론트는 결과로 “지급됨/미지급”만 받아서 토스트 띄우면 됨.
4) 개발 표준 + 추가 기능 적용 순서 (최소 수정 / 리스크 낮음 순)
1순위) UI 문구/CTA를 어드민에서 바꾸기 (가장 안전, 효과 즉시)

DB: app_ui_config 추가
BE: GET /api/ui-config
FE: 티켓0 패널에서 문구/링크를 config로 렌더링

✅ 이거만 해도 “문의하세요”가 “원클릭 해결”로 바뀌면서 이탈이 확 줄어.
2순위) 체험 티켓 “오늘 첫 접속 1장” (락아웃 최소 제거)
DB: user_grant_log (또는 wallet log에 grant_key 컬럼)
BE: POST /api/wallet/trial-grant (멱등)
FE: 홈 진입 시 1회 호출 + 토큰 갱신

✅ 락아웃이 사라지고 습관 형성 시작점이 만들어짐.
3순위) 텔레 구독 확인 보너스 (어드민 on/off)
여기서 갈림:
최소수정 버전(권장): “구독 인증은 운영자 버튼으로 처리”
어드민에서 특정 유저에 TRIAL_TELEGRAM_SUB 지급 버튼
자동 검증 시스템은 나중에
자동 검증 버전: 텔레그램 봇/웹훅까지 들어가서 공수가 커짐
✅ “최소수정 + 운영가능”이 목적이면 수동 지급이 현실적.

4순위) 팀배틀 참여중 1회 한정 지급
팀배틀 참여 상태는 BE에 이미 있을 확률 높음 (/api/team-battle/teams/me)
그 값을 trial-grant에서 같이 체크:
if joined_team and not granted(TRIAL_TEAM_BATTLE) then grant

5순위) 금고 프리뷰(보상 프리뷰) + “다음 보상까지 점수” UI
FE 작업 비중이 좀 있지만 로직은 단순:
시즌패스 다음 레벨 reward + 남은 XP
룰렛/복권 보상 테이블 일부(대표 6~10개) 보여주기

5) “최소 수정”을 위해 절대 피해야 할 패턴
프론트에서 지급 조건을 판단하고 지급 요청을 여러 번 보내는 구조 (중복 지급/꼬임)
텔레그램 구독 자동 검증을 1차 버전에 넣기 (시간/리스크 큼)
지급 로직을 시즌패스/팀배틀/월렛에 각각 따로 구현 (유지보수 지옥)




GPT-5.2 • 1