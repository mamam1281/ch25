# Admin Ranking Guide (External Data 포함)
문서 타입: 가이드
버전: v1.1
작성일: 2025-12-25
작성자: 시스템 설계팀
대상 독자: 관리자, 데이터 운영자, 백엔드/프론트엔드 개발자

## 1. 목적 (Purpose)
- 외부 랭킹 데이터 입력·집계·보상 처리 절차와 검증 포인트를 명확히 한다.

## 2. 범위 (Scope)
- 외부 플랫폼 입금/게임횟수 입력, 내부 집계 합산, 랭킹 API 확인, 시즌 종료 보상 실행과 로그 기록을 포함한다.

## 3. 용어 정의 (Definitions)
- 외부 랭킹 데이터: 관리자 입력 테이블에 쌓이는 외부 입금/게임횟수 데이터.
- 합산 랭킹: 내부 집계 + 외부 데이터 가중치를 반영한 결과.

## 4. 입력/집계 절차
1) 로그인: `/admin/login` (기본 `admin` 계정).
2) 외부 데이터 입력
   - UI 이전: 설계 문서의 외부 랭킹 테이블에 직접 INSERT/UPDATE(입금액, 게임횟수, 메모).
   - UI 이후: 외부 랭킹 탭에서 user_id별 값 입력/수정/삭제.
3) 집계 확인
   - `GET /admin/api/ranking/{date}` → 내부+외부 합산 랭킹 200 OK 확인.
   - 정책(입금/게임횟수 가중치, 동점 처리)이 설계(`docs/external_ranking_design.md`)대로인지 응답 필드 검증.

## 5. 시즌 종료 보상
- 랭킹 컷/보상 규칙 확정 후 관리자 스크립트/API로 지급.
- 지급 로그 필수 필드: user_id, 보상 타입/값, 사유 "EXTERNAL_RANKING", 시즌/날짜.
- 지급 후 검증: 지급 로그 테이블, 코인/포인트 지갑 변동 확인.

## 6. 오류/운영 체크
- 404/500: 백엔드 로그(`docker compose logs backend --tail=100`), 날짜 포맷/시즌 연동 확인.
- 데이터 불일치: 외부 테이블 최신 여부, 중복 user_id 여부, 가중치/합산 규칙 확인 후 재집계.

## 7. QA 체크리스트
- 외부 데이터 입력 후 `GET /admin/api/ranking/{date}` 200 OK.
- 시즌 종료 보상 실행 후 지급 로그 생성 확인.
- 사용자 노출 랭킹(있다면)과 관리자 집계 결과 일치.

## 8. 변경 이력
- v1.1 (2025-12-25, 시스템 설계팀): 문서 규칙 적용, 목적/범위/QA 명시.
- v1.0 (2025-12-08, 시스템 설계팀): 최초 작성.
