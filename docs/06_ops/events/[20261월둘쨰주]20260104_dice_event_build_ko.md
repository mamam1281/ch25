# ğŸ¯ ì£¼ì‚¬ìœ„ í”¼í¬íƒ€ì„ ì´ë²¤íŠ¸(ì¡°ê±´ë¶€ ì¶œê¸ˆ) ë¹Œë“œ ë¬¸ì„œ (Implementation Ready)

ì‘ì„±ì¼: 2026-01-04
ë²„ì „: v2.0 (ì‹¤í–‰ ê°€ëŠ¥ êµ¬í˜„ ìˆ˜ì¤€)

## 0. ëª©í‘œ / í•œ ì¤„ ì •ì˜
- **30ë§Œì› ì¶©ì „ ìœ ì € ëŒ€ìƒ**ìœ¼ë¡œ í”¼í¬íƒ€ì„(30ë¶„) ë™ì•ˆ ì£¼ì‚¬ìœ„ í”Œë ˆì´ ê²°ê³¼ë¡œ ê¸ˆê³  ì ë¦½ì„ ì²´ê°ì‹œí‚¤ë˜,
- **ì¦‰ì‹œ ì¶œê¸ˆ ë¶ˆê°€(ì ê¸ˆ)** + **í”Œë ˆì´ ì¡°ê±´ ì¶©ì¡± ì‹œì—ë§Œ í•´ì œ(ì¡°ê±´ë¶€ ì¶œê¸ˆ)**ë¡œ ë¹„ìš©ì„ í†µì œí•œë‹¤.

## 1. ì´ë²¤íŠ¸ UX(ìœ ì € ê´€ì )
### 1-1. ì°¸ì—¬ ì¡°ê±´
- ì¶©ì „ íŠ¸ë¦¬ê±°: **ë‹¨ì¼ ì¶©ì „ 30ë§Œì›**(ì™¸ë¶€ ê²€ì¦/ì–´ë“œë¯¼ ì…ë ¥ í¬í•¨)
- ëŒ€ìƒì ì»·(ì˜ˆì‹œ, ì„œë²„ íŒë³„):
  - ìµœê·¼ 14ì¼ ë‚´ ì¶©ì „ 1íšŒ ì´ìƒ (`UserActivity.last_charge_at` ê¸°ë°˜)
  - ëˆ„ì  ì¶©ì „ 3ë§Œì› ì´ìƒ (`ExternalRankingData.deposit_amount` ê¸°ë°˜)
  - ì œì™¸: `AdminUserProfile.tags`ì— `Blacklist` í¬í•¨ ìœ ì €

### 1-2. ì§€ê¸‰/ì •ì‚°
- ì¶©ì „ í™•ì¸ ì‹œì ì— **ê¸ˆê³  ì ê¸ˆ ì ë¦½ 20,000ì›** ë¶€ì—¬ (ì¦‰ì‹œ ì¶œê¸ˆ ë¶ˆê°€)
- í”¼í¬íƒ€ì„ 30ë¶„ ë™ì•ˆ ì£¼ì‚¬ìœ„ í”Œë ˆì´ ê²°ê³¼ì— ë”°ë¼ ê¸ˆê³  ì ê¸ˆ ì”ê³ ê°€ **ì¦ê°€/ê°ì†Œ**
- **ì£¼ì‚¬ìœ„ 30íšŒ í”Œë ˆì´ ì™„ë£Œ** ì‹œì—ë§Œ ì ê¸ˆ í•´ì œ(ì¶œê¸ˆ ê°€ëŠ¥ ìƒíƒœë¡œ ì „í™˜)

### 1-3. â€œ0ì´ë©´ ë°‘ì ¸ì•¼ ë³¸ì „â€ ë°©ì§€(ë¦¬ìŠ¤í¬ê°€ ì‹¤ì œë¡œ ë°œìƒí•˜ë„ë¡)
ì•„ë˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒ(ê¶Œì¥ ìˆœì„œ):
1) **ì´ë²¤íŠ¸ ëª¨ë“œ ì°¸ì—¬ ì¡°ê±´ìœ¼ë¡œ â€œì´ë²¤íŠ¸ ìŠ¤í…Œì´í¬(ì ê¸ˆ ì”ê³ ) ìµœì†Œì¹˜â€ ìš”êµ¬**
   - ì˜ˆ: ì´ë²¤íŠ¸ ì£¼ì‚¬ìœ„ëŠ” ì‹œì‘ ì‹œì ì— ì ê¸ˆ ì”ê³ (ì´ë²¤íŠ¸ ìŠ¤í…Œì´í¬) >= 2,000ì›ì¼ ë•Œë§Œ ì§„ì… ê°€ëŠ¥
   - ìŠ¤í…Œì´í¬ê°€ 0ì´ ë˜ë©´ ì´ë²¤íŠ¸ ëª¨ë“œ ì§„ì… ë¶ˆê°€(= ë°”ë‹¥ ë³¸ì „ í”Œë ˆì´ ì°¨ë‹¨)
2) **ë¯¸ìˆ˜ê¸ˆ(ìŒìˆ˜) í—ˆìš©(ë¹„ê¶Œì¥)**
   - í˜„ì¬ v1 ê¸ˆê³ ëŠ” ìŒìˆ˜ë¡œ ë‚´ë ¤ê°ˆ ìˆ˜ ìˆì–´ â€œì°¨ê°ì€ ì‹¤ì œ ë°œìƒâ€í•˜ë‚˜,
   - ìœ ì € ë°˜ë°œ/CS/ì‹ ë¢° ë¦¬ìŠ¤í¬ê°€ ì»¤ì„œ ê¸°ë³¸ ì •ì±…ìœ¼ë¡œëŠ” ë¹„ê¶Œì¥

## 2. ê³µì •ì„±/ì‹ ë¢° ì›ì¹™(í•„ìˆ˜)
- (ìš´ì˜ ì„ íƒ) ë³¸ ì´ë²¤íŠ¸ëŠ” **ê°€ìƒë¨¸ë‹ˆ(ê¸ˆê³  ì ê¸ˆ ì”ê³ ) ê¸°ë°˜ ì´ë²¤íŠ¸ ëª¨ë“œ**ë¡œ, ì„œë²„ê°€ ì´ë²¤íŠ¸ ëª¨ë“œì—ì„œ **ìŠ¹/ë¬´/íŒ¨ í™•ë¥  ë° í˜ì´í…Œì´ë¸”ì„ ìš´ì˜ íŒŒë¼ë¯¸í„°ë¡œ ê´€ë¦¬**í•  ìˆ˜ ìˆë‹¤.
- ëŒ€ì‹  ì•„ë˜ í•­ëª©ì€ ìš´ì˜/CS ê´€ì ì—ì„œ ë°˜ë“œì‹œ ê³ ì •Â·ê´€ë¦¬í•œë‹¤:
  - ì´ë²¤íŠ¸ ê¸°ê°„
  - ëŒ€ìƒì ì¡°ê±´
  - 1ì¼ ìƒí•œ(ì§€ê¸‰/ì†ì‹¤)
  - ì¶œê¸ˆ ì¡°ê±´(30íšŒ)
  - (ì„ íƒ) ìŠ¹/íŒ¨ ì‹œ ì ë¦½/ì°¨ê°ì•¡ ë²”ìœ„

## 3. í˜„ì¬ ì½”ë“œ/DBì—ì„œ ê°€ëŠ¥í•œ ê²ƒ(íŒ©íŠ¸)
### 3-1. ì¶©ì „/ì…ê¸ˆ íŒë³„ ë°ì´í„°
- ëˆ„ì  ì…ê¸ˆì•¡: `external_ranking_data.deposit_amount`
- ìµœê·¼ ì¶©ì „ ì‹œê°: `user_activity.last_charge_at`
  - ì£¼ì˜: ì´ ê°’ì€ â€œê±°ë˜ ë¡œê·¸â€ê°€ ì•„ë‹ˆë¼ **external_ranking_data ê°±ì‹  ì‹œê°(row.updated_at)**ì„ ì¶©ì „ ì‹œê°ìœ¼ë¡œ ê°„ì£¼í•´ ê¸°ë¡ë¨

### 3-2. í‹°ì¼“(ì£¼ì‚¬ìœ„ í† í°) ì¶œì²˜ êµ¬ë¶„
- TRIAL(ì²´í—˜) í† í° ì‚¬ìš© ì—¬ë¶€ëŠ” `consumed_trial`ë¡œ íŒë³„ ê°€ëŠ¥
- ê·¸ ì™¸ â€œë¬´ë£Œ ì§€ê¸‰ vs êµ¬ë§¤â€ë¥¼ ì¼ë°˜ì ìœ¼ë¡œ êµ¬ë¶„í•  í‘œì¤€ í•„ë“œëŠ” í˜„ì¬ ë¶€ì¡±
  - ë”°ë¼ì„œ â€˜ì¼ë°˜ í‹°ì¼“ ê¸°ì¤€â€™ì´ë¼ëŠ” ì¡°ê±´ì€ **í˜„ ìƒíƒœì—ì„  â€˜TRIAL ì œì™¸â€™ ì •ë„ë§Œ ê°•ì œ ê°€ëŠ¥**

### 3-3. ê¸ˆê³  ì ë¦½/ì°¨ê° ì²˜ë¦¬
- ê¸ˆê³  v1 ì ê¸ˆ ì”ê³ ëŠ” `User.vault_locked_balance`ì— ëˆ„ì ë¨
- ê²Œì„ ì ë¦½ ì´ë²¤íŠ¸ëŠ” `VaultService.record_game_earn_event()`ê°€ ë‹´ë‹¹
  - DICEì˜ ìŠ¹/íŒ¨ ê¸°ë³¸ê°’ì€ fallback ê¸°ì¤€ WIN=200 / LOSE=-50
  - ë°°ìœ¨ì€ `vault_accrual_multiplier()`ë¥¼ í†µí•´ ì ìš©
- Vault2(í”„ë¡œê·¸ë¨/config)ëŠ” **ìš´ì˜ìš© ì„¤ì • ì €ì¥ì†Œë¡œ í™œìš© ê°€ëŠ¥**
  - `VaultProgram.config_json.game_earn_config`ë¡œ DICE WIN/LOSE ê°’ ìš´ì˜ ì¡°ì • ê°€ëŠ¥

## 4. êµ¬í˜„ ì„¤ê³„(ê¶Œì¥ ì•„í‚¤í…ì²˜)

### 4-1. ì´ë²¤íŠ¸ ìƒíƒœ(ì„œë²„ê°€ ì•Œì•„ì•¼ í•˜ëŠ” ìµœì†Œ ì •ë³´)
í•„ìˆ˜ ìƒíƒœ:
- `event_id`: ì˜ˆ) `DICE_PEAK_202601`
- `user_id`
- `eligible`: ëŒ€ìƒì ì¡°ê±´ í†µê³¼ ì—¬ë¶€
- `session_window`: ì‹œì‘/ì¢…ë£Œ(í”¼í¬íƒ€ì„ 30ë¶„)
- `plays_required`: 30
- `plays_done`: ì´ë²¤íŠ¸ ê¸°ê°„ ë‚´ ì£¼ì‚¬ìœ„ í”Œë ˆì´ íšŸìˆ˜
- `locked_grant_amount`: 20,000
- `stake_balance`: ì´ë²¤íŠ¸ ìŠ¤í…Œì´í¬(ì ê¸ˆ ì”ê³  ë‚´ì—ì„œ ì¶”ì )

ì €ì¥ ìœ„ì¹˜(ì„ íƒì§€):
1) **Vault2 `VaultStatus.progress_json` ì‚¬ìš©(ì¶”ì²œ)**
   - ì´ë²¤íŠ¸ ì§„í–‰/íšŸìˆ˜/ìƒíƒœë¥¼ JSONìœ¼ë¡œ ì €ì¥
2) ë³„ë„ í…Œì´ë¸” ì‹ ì„¤(í™•ì¥ì„±â†‘)

### 4-2. ì§€ê¸‰(ì¶©ì „ íŠ¸ë¦¬ê±°) ì²˜ë¦¬
- íŠ¸ë¦¬ê±°: â€œ30ë§Œì› ì¶©ì „ í™•ì¸â€ ì‹œì 
- ì•¡ì…˜:
  1) ìœ ì €ë¥¼ ì´ë²¤íŠ¸ eligibleë¡œ ë§ˆí‚¹
  2) ê¸ˆê³  ì ê¸ˆ ì”ê³ ì— 20,000ì› ì¶”ê°€(= ì´ë²¤íŠ¸ ìŠ¤í…Œì´í¬ ìƒì„±)
  3) ì´ë²¤íŠ¸ ì§„í–‰ ìƒíƒœ ì´ˆê¸°í™”(plays_done=0 ë“±)

ì£¼ì˜:
- ì™¸ë¶€ ì¶©ì „ ê²€ì¦ì´ í˜„ì¬ ìˆ˜ë™ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **ì–´ë“œë¯¼ ë²„íŠ¼/ì—”ë“œí¬ì¸íŠ¸**ë¡œ íŠ¸ë¦¬ê±° ê°€ëŠ¥í•´ì•¼ í•¨

### 4-3. í”Œë ˆì´ íšŸìˆ˜ ì¹´ìš´íŒ…
- ì´ë²¤íŠ¸ ê¸°ê°„ ë‚´ ì£¼ì‚¬ìœ„ í”Œë ˆì´ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ `plays_done += 1`
- TRIAL ì†Œë¹„ í”Œë ˆì´ëŠ” ì œì™¸í•˜ê³  ì‹¶ë‹¤ë©´:
  - `GameWalletService.require_and_consume_token()` ê²°ê³¼ì˜ `consumed_trial`ì„ í™œìš©í•´ ì œì™¸

### 4-4. ìŠ¹/íŒ¨ ì ë¦½/ì°¨ê°(ìŠ¤í…Œì´í¬ ê¸°ë°˜)
- ì´ë²¤íŠ¸ ëª¨ë“œì—ì„œë§Œ ì ìš©ë˜ëŠ” ë³„ë„ ë£°ì„ ë‘”ë‹¤:
- ì´ë²¤íŠ¸ ëª¨ë“œì—ì„œëŠ” (A) **ìŠ¹/ë¬´/íŒ¨ í™•ë¥ **ê³¼ (B) **ìŠ¹/ë¬´/íŒ¨ ê¸ˆì•¡(í˜ì´í…Œì´ë¸”)**ì„ í•¨ê»˜ ìš´ì˜ íŒŒë¼ë¯¸í„°ë¡œ ë‘”ë‹¤.

#### 4-4-1. ëª©í‘œ: â€œ20,000ì› ì‹œì‘ â†’ 30íšŒ í›„ í‰ê·  14,000ì›â€ (ì´ë²¤íŠ¸ ëª¨ë“œ)
- ëª©í‘œ í‰ê·  ìµœì¢… ì”ê³ ê°€ 14,000ì›ì´ë©´, 30íšŒ ë™ì•ˆ í‰ê· ìœ¼ë¡œëŠ” **-6,000ì›** ì •ë„ ë‚´ë ¤ê°€ë©´ ëœë‹¤.
  - 1íšŒë‹¹ í‰ê·  ë³€í™”ëŠ” ëŒ€ëµ **-200ì›/íšŒ**

#### 4-4-2. ê¶Œì¥ í˜ì´í…Œì´ë¸”(í•˜ìš°ìŠ¤ ìœ ë¦¬ ì¡°ì •)
- ê¸°ë³¸(ê¶Œì¥): **WIN=+1,400 / DRAW=-800 / LOSE=-1,100** (í•˜ìš°ìŠ¤ ìœ ë¦¬í•˜ê²Œ ì¡°ì •: WIN ì¦ê°€, LOSE ê°ì†Œë¡œ ìœ ì € ì²´ê° ì™„í™”)
- ëŒ€ì•ˆ(ë” ì—„ê²©): **WIN=+1,200 / DRAW=-1,000 / LOSE=-1,320** (ê¸°ì¡´, í•˜ìš°ìŠ¤ ì´ë“ ë” í¼)

#### 4-4-3. ê¶Œì¥ í™•ë¥  ì„¸íŒ…(ì˜ˆì‹œ)
- í™•ë¥ ì€ ì´ë²¤íŠ¸ ëª¨ë“œì—ì„œ `p_win`, `p_draw`, `p_lose`ë¡œ ì„¤ì •í•˜ê³ , ë§¤ íŒ ê²°ê³¼ë¥¼ **ê°€ì¤‘ì¹˜ ëœë¤**ìœ¼ë¡œ ê²°ì •í•œë‹¤.
- 30íšŒ í‰ê·  14,000ì›ì„ ëª©í‘œë¡œ í•  ë•Œì˜ ì˜ˆì‹œ(ìš´ì˜ ì¤‘ ë¯¸ì„¸ ì¡°ì • ê°€ëŠ¥):
  - p_draw=0.10, p_win=0.35, p_lose=0.55
  - í‰ê·  ë³€í™” ê³„ì‚° (í˜ì´í…Œì´ë¸” ì ìš© ì‹œ): (0.35 * 1400) + (0.10 * -800) + (0.55 * -1100) â‰ˆ -195ì›/íšŒ
  - 30íšŒ ê¸°ì¤€ í‰ê·  ì”ê³ : 20,000 - (195 * 30) â‰ˆ 14,150ì› (ëª©í‘œ ê·¼ì ‘, í•˜ìš°ìŠ¤ ì´ë“ ì¦ê°€)

#### 4-4-3-1. í™•ë¥ /í˜ì´í…Œì´ë¸” ë¹„êµí‘œ (ìš´ì˜ ì„ íƒìš©)

| ì‹œë‚˜ë¦¬ì˜¤ | p_win | p_draw | p_lose | WIN | DRAW | LOSE | 1íšŒë‹¹ í‰ê·  | 30íšŒ í›„ ì”ê³  |
|----------|-------|--------|--------|-----|------|------|------------|--------------|
| ê¸°ë³¸(ê¶Œì¥) | 0.35 | 0.10 | 0.55 | +1,400 | -800 | -1,100 | -195ì› | ~14,150ì› |
| ë³´ìˆ˜ì (í•˜ìš°ìŠ¤+) | 0.30 | 0.10 | 0.60 | +1,400 | -800 | -1,100 | -290ì› | ~11,300ì› |
| ì™„í™”(ìœ ì €+) | 0.40 | 0.10 | 0.50 | +1,400 | -800 | -1,100 | -110ì› | ~16,700ì› |
| ê¸°ì¡´(ì°¸ê³ ) | 0.444 | 0.11 | 0.446 | +1,200 | -1,000 | -1,320 | -167ì› | ~15,000ì› |



#### 4-4-4. êµ¬í˜„ í¬ì¸íŠ¸(í™•ë¥  ì¡°ì‘ ë°©ì‹)
- ê²°ê³¼(outcome)ë¥¼ ë¨¼ì € ê°€ì¤‘ì¹˜ë¡œ ê²°ì •í•œ ë’¤, ê·¸ ê²°ê³¼ì— ë§ëŠ” ì£¼ì‚¬ìœ„ ëˆˆì„ ìƒì„±í•œë‹¤.
  - ì˜ˆ: outcome=WINì´ë©´ ì‚¬ìš©ì í•©ì´ ë”œëŸ¬ í•©ë³´ë‹¤ í¬ê²Œ ë‚˜ì˜¤ë„ë¡ ëˆˆì„ ìƒì„±
  - outcome=DRAWì´ë©´ í•©ì´ ê°™ë„ë¡ ëˆˆì„ ìƒì„±
- ì´ë ‡ê²Œ í•˜ë©´ â€œì£¼ì‚¬ìœ„ ê°’â€ì€ í•­ìƒ ì •ìƒ ë²”ìœ„(1~6)ë¡œ ë³´ì´ë©´ì„œë„, ì´ë²¤íŠ¸ ëª¨ë“œì˜ ëª©í‘œ í‰ê· ì„ ì•ˆì •ì ìœ¼ë¡œ ë§ì¶œ ìˆ˜ ìˆë‹¤.
- ë¶„í¬(ì²´ê°) ê´€ì :
  - 15ëª…ì´ë©´ 0ì›/5ì²œ/2ë§Œ/3ë§Œ/4ë§Œì²˜ëŸ¼ **ë‹¤ì–‘í•˜ê²Œ** ê°ˆ ìˆ˜ ìˆë‹¤.
  - ë˜í•œ ìš´ì˜ ëª©ì ì— ë”°ë¼ **ìœ ì €ë³„ë¡œ í•¸ë“¤ë§ ì •ì±…(í™•ë¥ /í˜ì´í…Œì´ë¸”/ìƒí•œ)ì„ ë‹¤ë¥´ê²Œ** ì ìš©í•  ìˆ˜ ìˆë‹¤.
  - ê·¸ë˜ì„œ ìƒí•œ(+20,000)ê³¼ ë°”ë‹¥(ìŠ¤í…Œì´í¬ 0 ì¤‘ë‹¨)ì„ ê°™ì´ ë‘ë©´ ë¹„ìš©ê³¼ ë¦¬ìŠ¤í¬ë¥¼ ë” ì•ˆì •ì ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥.
- ì„¸ë¶€ êµ¬í˜„ ì²´í¬:
  - **ëœë¤ ìƒì„±**: `random.choices()` ë˜ëŠ” ìœ ì‚¬ í•¨ìˆ˜ë¡œ p_win, p_draw, p_lose ê°€ì¤‘ì¹˜ ì ìš©. ì‹œë“œ ê³ ì •ìœ¼ë¡œ ì¬í˜„ì„± í™•ë³´ (í…ŒìŠ¤íŠ¸ìš©).
  - **ì£¼ì‚¬ìœ„ ëˆˆ ìƒì„± ë¡œì§**: outcome=WIN ì‹œ, ìœ ì € í•© > ë”œëŸ¬ í•©ì´ ë˜ë„ë¡ 1~6 ë²”ìœ„ ë‚´ ëœë¤ ì¡°í•© (ì˜ˆ: ìœ ì € 6+5=11, ë”œëŸ¬ 4+3=7). DRAW ì‹œ í•© ê°™ê²Œ, LOSE ì‹œ ìœ ì € í•© < ë”œëŸ¬ í•©.
  - **ì´ë²¤íŠ¸ ëª¨ë“œ íŒë³„**: `DiceService.play()`ì—ì„œ ì´ë²¤íŠ¸ ìƒíƒœ í™•ì¸ (Vault2.progress_json ë˜ëŠ” ë³„ë„ í…Œì´ë¸”). ì´ë²¤íŠ¸ ì¤‘ì´ë©´ í™•ë¥ /í˜ì´í…Œì´ë¸” ì ìš©.
  - **ì ë¦½ ì²˜ë¦¬**: `VaultService.record_game_earn_event()` í˜¸ì¶œ ì‹œ ì´ë²¤íŠ¸ ëª¨ë“œ í”Œë˜ê·¸ ì¶”ê°€, í˜ì´í…Œì´ë¸” ê¸°ë°˜ ê¸ˆì•¡ ê³„ì‚°.
  - **ì¹´ìš´íŒ…**: plays_done ì¦ê°€ ì‹œ TRIAL ì œì™¸ ë¡œì§ ì¶”ê°€ (`consumed_trial` ì²´í¬).
  - **ìƒí•œ/ë°”ë‹¥ ì²´í¬**: í”Œë ˆì´ ì „í›„ ìŠ¤í…Œì´í¬ ì”ê³  í™•ì¸, 0 ì´í•˜ ì‹œ ì´ë²¤íŠ¸ ëª¨ë“œ ì¤‘ë‹¨, ìƒí•œ ì´ˆê³¼ ì‹œ ì ë¦½ 0ìœ¼ë¡œ í´ë¨í”„.
  - **ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì œì™¸**: `AdminUserProfile.tags` ì¡°íšŒ í›„ 'Blacklist' í¬í•¨ ì‹œ í‘œì¤€ ëª¨ë“œë¡œ í´ë°±.
  - **ê°ì‚¬ ë¡œê·¸**: í™•ë¥ /í˜ì´í…Œì´ë¸” ë³€ê²½ ì‹œ ì–´ë“œë¯¼ ë¡œê·¸ ê¸°ë¡ (ë³€ê²½ ì „í›„ ê°’, íƒ€ì„ìŠ¤íƒ¬í”„).
  - **í…ŒìŠ¤íŠ¸**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ í™•ë¥  ë¶„í¬ ê²€ì¦ (1000íšŒ ì‹œë®¬ë ˆì´ì…˜, í‰ê·  ì”ê³  í™•ì¸).

#### 4-4-5. ìœ ì €ë³„ í•¸ë“¤ë§(íƒœê·¸/ì„¸ê·¸ë¨¼íŠ¸ ê¸°ë°˜)
- ê¸°ì¤€: **`AdminUserProfile.tags`ì— `Blacklist` í¬í•¨ ì—¬ë¶€ 1ê°€ì§€ë¡œë§Œ ì²˜ë¦¬**
- ì •ì±…(ê¶Œì¥): `Blacklist` ìœ ì €ëŠ” **ì´ë²¤íŠ¸ ëª¨ë“œ ì§„ì… ì°¨ë‹¨**(= ì´ë²¤íŠ¸ í™•ë¥ /í˜ì´í…Œì´ë¸” ì ìš© ëŒ€ìƒì—ì„œ ì œì™¸)
  - ìš´ì˜/CS ë¬¸êµ¬: â€œë¶€ì • ì´ìš© ë°©ì§€ ì •ì±…ì— ë”°ë¼ ì¼ë¶€ ê³„ì •ì€ ì´ë²¤íŠ¸ ëŒ€ìƒì—ì„œ ì œì™¸ë  ìˆ˜ ìˆìŒâ€
- ë°ì´í„° ì†ŒìŠ¤(í˜„ì¬ ì½”ë“œ/DBì— ì¡´ì¬): `AdminUserProfile.tags`
- êµ¬í˜„ í¬ì¸íŠ¸:
  - `DiceService.play()`ì—ì„œ ì´ë²¤íŠ¸ ëª¨ë“œ ì ìš© ì „ `AdminUserProfile.tags`ì— `Blacklist`ê°€ ìˆìœ¼ë©´ ì´ë²¤íŠ¸ ëª¨ë“œ ìŠ¤í‚µ
  - ìš´ì˜ ë³€ê²½ì€ ì¶”ì  ê°€ëŠ¥í•˜ë„ë¡ ê°ì‚¬ ë¡œê·¸(ì–´ë“œë¯¼ ë³€ê²½ ì´ë ¥) ê¶Œì¥
- ë¹„ìš© í†µì œ:
  - 1ì¼ ìµœëŒ€ í”Œë ˆì´ ìˆ˜(ì˜ˆ: 30íšŒ)
  - 1ì¼ ìµœëŒ€ ìˆœì¦(ì˜ˆ: +20,000 ìƒí•œ)
    - ì •ì˜(ê¶Œì¥): **ê²Œì„ í”Œë ˆì´ë¡œ ì¸í•´ ì¦ê°€í•œ ì ê¸ˆ ì”ê³ ì˜ ìˆœì¦ë¶„** ìƒí•œ
    - í•´ì„(ì§ˆë¬¸ ë‹µ): ì‹œì‘ ìŠ¤í…Œì´í¬ê°€ 20,000ì›ì¼ ë•Œ, â€œìˆœì¦ +20,000â€ì´ë©´ **ì´ë²¤íŠ¸ë¡œ ìµœëŒ€ +20,000ê¹Œì§€ ë” ë²Œ ìˆ˜ ìˆìŒ**
      - ì¦‰, ì ê¸ˆ ì”ê³ ê°€ ì´ ì´ë²¤íŠ¸ ë•Œë¬¸ì— ìµœëŒ€ **40,000(=20,000+20,000)**ê¹Œì§€ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸
      - ë§Œì•½ â€œ20,000 ì‹œì‘í•´ì„œ 20,000 ë„ë‹¬í•˜ë©´ ì¢…ë£Œ(ì´ì•¡ ìƒí•œ 20,000)â€ë¥¼ ì›í•˜ë©´, ìƒí•œì„ **â€˜ì´ ì ê¸ˆ ì”ê³  ìƒí•œâ€™**ìœ¼ë¡œ ë³„ë„ ì •ì˜í•´ì•¼ í•¨
    - ë™ì‘(ì˜ˆì‹œ): ìƒí•œ ë„ë‹¬ ì‹œ ì´ë²¤íŠ¸ ëª¨ë“œ ì ë¦½ì„ 0ìœ¼ë¡œ í´ë¨í”„í•˜ê±°ë‚˜, ì´ë²¤íŠ¸ ëª¨ë“œ ìì²´ë¥¼ ì¢…ë£Œ
  - ìŠ¤í…Œì´í¬ê°€ 0ì´ë©´ ì´ë²¤íŠ¸ ëª¨ë“œ ì¤‘ë‹¨

### 4-5. ì ê¸ˆ í•´ì œ(ì¶œê¸ˆ ê°€ëŠ¥ ì „í™˜)
- ì¡°ê±´: `plays_done >= plays_required`
- ì•¡ì…˜:
  - ì ê¸ˆ ê¸ˆì•¡(ì´ë²¤íŠ¸ ìŠ¤í…Œì´í¬ ì”ê³ )ì„ â€œì¶œê¸ˆ ê°€ëŠ¥ ìƒíƒœâ€ë¡œ ì „í™˜

í˜„ì¬ ì½”ë“œ ë² ì´ìŠ¤ ê¸°ì¤€ íŒíŠ¸:
- Vault2ì—ëŠ” LOCKED/AVAILABLE ìƒíƒœê°€ ìˆìœ¼ë‚˜, ê²Œì„í”Œë ˆì´ì— ì™„ì „ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŒ
- ë‹¨ê¸° êµ¬í˜„ì€ v1(User.vault_locked_balance / available mirror)ì™€ Vault2(ë¶í‚¤í•‘)ë¥¼ í•¨ê»˜ ì“°ëŠ” í˜•íƒœê°€ í˜„ì‹¤ì 

### 4-6. ë°±ì—”ë“œ API ìŠ¤í™ (Admin + User)
- **Admin Dice Config** ([app/api/admin/routes/admin_dice.py](app/api/admin/routes/admin_dice.py))
  - `GET /admin/api/dice-config/` : ì„¤ì • ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
  - `GET /admin/api/dice-config/{id}` : ë‹¨ê±´ ì¡°íšŒ
  - `POST /admin/api/dice-config/` : ìƒì„± (payload=win/draw/lose reward_type/amount, is_active, max_daily_plays)
  - `PUT /admin/api/dice-config/{id}` : ìˆ˜ì • (ë¶€ë¶„ í•„ë“œ í—ˆìš©)
  - `POST /admin/api/dice-config/{id}/activate` / `.../deactivate` : í™œì„±/ë¹„í™œì„± ì „í™˜
  - ì„œë¹„ìŠ¤ ë¡œì§: [app/services/admin_dice_service.py](app/services/admin_dice_service.py), ìŠ¤í‚¤ë§ˆ: [app/schemas/admin_dice.py](app/schemas/admin_dice.py)
- **User Dice Play** ([app/api/routes/dice.py](app/api/routes/dice.py))
  - `GET /api/dice/status` : ì˜¤ëŠ˜ í”Œë ˆì´ìˆ˜, í† í° ì”ì•¡ ë¦¬í„´
  - `POST /api/dice/play` : ì£¼ì‚¬ìœ„ 1íšŒ í”Œë ˆì´, ê²°ê³¼+reward_amount ë°˜í™˜, Vault ì ë¦½ì€ ë‚´ë¶€ì—ì„œ í˜¸ì¶œ
  - ê²Œì„ ë¡œì§: [app/services/dice_service.py](app/services/dice_service.py)
- **Vault ì ë¦½** ([app/services/vault_service.py](app/services/vault_service.py))
  - `record_game_play_earn_event(...)` : game_type/outcome/payout_rawë¥¼ ë°›ì•„ ë©±ë“± ì ë¦½. VaultProgram.config_json.game_earn_config > payout_raw.reward_amount > ê¸°ë³¸ê°’ ìˆœìœ¼ë¡œ ê¸ˆì•¡ ê²°ì •.
  - `vault_accrual_multiplier(...)` : DB(config_json.accrual_multiplier) ë˜ëŠ” env ë°°ìœ¨ ì ìš©.
- **ì´ë²¤íŠ¸ ìƒíƒœ ì €ì¥ (ì¶”ì²œ)**
  - Vault2 ìƒíƒœ: [app/models/vault2.py](app/models/vault2.py) ì˜ `VaultStatus.progress_json` í™œìš©
  - ì„¤ì • ì €ì¥: [app/models/vault2.py](app/models/vault2.py) ì˜ `VaultProgram.config_json` ì‚¬ìš© (í™•ë¥ /í˜ì´í…Œì´ë¸”/ìƒí•œ/eligibility)

### 4-7. ì–´ë“œë¯¼ UI íë¦„ (í”„ë¡ íŠ¸)
- í˜ì´ì§€: [src/admin/pages/DiceConfigPage.tsx](src/admin/pages/DiceConfigPage.tsx)
  - ë¦¬ìŠ¤íŠ¸/ìƒì„±/ìˆ˜ì •/í™œì„±í™” í† ê¸€ ì§€ì›. ê¸ˆì•¡ ì…ë ¥ ì‹œ ìŒìˆ˜ í—ˆìš©(ì°¨ê°), reward_typeì€ NONE ê¶Œì¥.
  - ì €ì¥ ì‹œ react-query invalidateë¡œ ì¦‰ì‹œ ë°˜ì˜.
- ì¶”ê°€ í•„ìš” UI(ì´ë²¤íŠ¸ìš©)
  - â€œì´ë²¤íŠ¸ ëª¨ë“œ íŒŒë¼ë¯¸í„°â€ ì„¹ì…˜: p_win/p_draw/p_lose, WIN/DRAW/LOSE ê¸ˆì•¡, 1ì¼ ìµœëŒ€ ìˆœì¦/í”Œë ˆì´ ìˆ˜ ì„¤ì • ì…ë ¥ â†’ VaultProgram.config_jsonì— ì €ì¥í•˜ëŠ” Admin Form ì‹ ì„¤ ê¶Œì¥.
  - â€œëŒ€ìƒì/ì„¸ì…˜ ê´€ë¦¬â€ ì„¹ì…˜: eligible ë§ˆí‚¹/í•´ì œ, ì„¸ì…˜ ì‹œì‘/ì¢…ë£Œ(30ë¶„ íƒ€ì´ë¨¸), ìŠ¤í…Œì´í¬ ì´ˆê¸°í™” ë²„íŠ¼.

### 4-8. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì„œë²„/í”„ë¡ íŠ¸)
- ì„œë²„
  - DiceServiceì— â€œì´ë²¤íŠ¸ ëª¨ë“œ ë¶„ê¸°â€ ì¶”ê°€: event_active && not_blacklist && stake>0 && within_session â†’ ê°€ì¤‘ì¹˜ í™•ë¥ /í˜ì´í…Œì´ë¸” ì ìš©, stake_balance ì—…ë°ì´íŠ¸, plays_done++.
  - VaultService.record_game_earn_event í˜¸ì¶œ ì‹œ payout_rawì— `{"reward_amount": ì´ë²¤íŠ¸ ê²°ê³¼ ê¸ˆì•¡, "mode": "EVENT"}` í¬í•¨.
  - ì°¸ê³ : ìŠ¤íŠ¸ë¦­ ê¸ˆê³  ë³´ë„ˆìŠ¤(ê¸°ë³¸ 200ì› ì ë¦½ ë°°ìœ¨)ëŠ” `mode != NORMAL`ì¸ í”Œë ˆì´(ì¦‰, EVENT ëª¨ë“œ)ì—ëŠ” ì ìš©ë˜ì§€ ì•Šë„ë¡ ì„¤ê³„/êµ¬í˜„ë˜ì–´ì•¼ í•¨.
  - VaultProgram.config_jsonì— `game_earn_config.DICE.{WIN,DRAW,LOSE}`, `probability.DICE.{p_win,p_draw,p_lose}`, `caps.{daily_gain, daily_plays}`, `eligibility.tags.blocklist=["Blacklist"]` ì €ì¥/ë¡œë“œ ë¡œì§ ì¶”ê°€.
  - ì´ë²¤íŠ¸ ìƒíƒœ ì €ì¥: VaultStatus.progress_jsonì— `{plays_done, plays_required, session_start, session_end, stake_balance}` ì €ì¥/ì—…ë°ì´íŠ¸.
  - ì–´ë“œë¯¼ ê°ì‚¬ ë¡œê·¸: í™•ë¥ /í˜ì´í…Œì´ë¸”/ìƒí•œ ë³€ê²½ ì‹œ AdminAuditLogì— before/after ê¸°ë¡.
- í”„ë¡ íŠ¸ (ì‚¬ìš©ì)
  - DicePage: ê²°ê³¼ì— ë”°ë¼ VaultAccrualModalì„ ìŠ¹/íŒ¨ ëª¨ë‘ ë…¸ì¶œ(ìŒìˆ˜ ì‹œ â€œê¸ˆê³  ì°¨ê°â€ í‘œê¸°), TRIAL ì†Œë¹„ ì‹œ plays_done ì œì™¸ ë¡œì§ê³¼ ì—°ë™.
  - í”¼í¬íƒ€ì„ UI: ì„¸ì…˜ íƒ€ì´ë¨¸(30ë¶„) ì¹´ìš´íŠ¸ë‹¤ìš´, ë‚¨ì€ í”Œë ˆì´ìˆ˜(plays_required - plays_done) í‘œì‹œ.
  - ìŠ¤í…Œì´í¬ ë¶€ì¡±/0ì¼ ë•Œ ì´ë²¤íŠ¸ ëª¨ë“œ ì§„ì… ì°¨ë‹¨ ì•ˆë‚´ ë°°ë„ˆ.
- í”„ë¡ íŠ¸ (ì–´ë“œë¯¼)
  - DiceConfigPage í™•ì¥: ì´ë²¤íŠ¸ ëª¨ë“œ íƒ­(í™•ë¥ /í˜ì´í…Œì´ë¸”/ìƒí•œ ì…ë ¥) ì¶”ê°€, ì €ì¥ ì‹œ VaultProgram.config_json ì—…ë°ì´íŠ¸ API ì—°ë™.
  - ëŒ€ìƒì íŒ¨ë„: Blacklist íƒœê·¸ ì¶”ê°€/ì‚­ì œ í€µì•¡ì…˜, eligible ê°•ì œ í† ê¸€(ì¶©ì „ ê²€ì¦ ìˆ˜ë™ ì²˜ë¦¬ìš©).
  - ë¡œê·¸ ë·°ì–´: ìµœê·¼ ì´ë²¤íŠ¸ í”Œë ˆì´ ê²°ê³¼, ì ë¦½ì•¡, ìƒí•œ ë„ë‹¬ ì—¬ë¶€, ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ìƒíƒœë¥¼ í‘œë¡œ ë…¸ì¶œ.

### 4-9. API Contract ì˜ˆì‹œ (í˜„í–‰ ì—”ë“œí¬ì¸íŠ¸ ê¸°ë°˜)
- Admin Dice Config
  - `POST /admin/api/dice-config/`
    - Request JSON:
      ```json
      {
        "name": "Peak Dice 202601",
        "is_active": true,
        "max_daily_plays": 0,
        "win_reward_type": "NONE",
        "win_reward_amount": 1400,
        "draw_reward_type": "NONE",
        "draw_reward_amount": -800,
        "lose_reward_type": "NONE",
        "lose_reward_amount": -1100
      }
      ```
    - Response JSON (201): ìœ„ í•„ë“œ + `id`, `created_at`, `updated_at`
  - `PUT /admin/api/dice-config/{id}` : ë™ì¼ í•„ë“œ ë¶€ë¶„ ì—…ë°ì´íŠ¸. ìŒìˆ˜ ê¸ˆì•¡ í—ˆìš©(ì°¨ê°).
  - `POST /admin/api/dice-config/{id}/activate` / `.../deactivate` : is_active í† ê¸€.
- User Dice Play
  - `POST /api/dice/play`
    - Response JSON ì˜ˆì‹œ:
      ```json
      {
        "result": "OK",
        "game": {
          "user_dice": [3, 6],
          "dealer_dice": [2, 5],
          "user_sum": 9,
          "dealer_sum": 7,
          "outcome": "WIN",
          "reward_type": "NONE",
          "reward_amount": 1400
        },
        "season_pass": null,
        "vault_earn": 1400
      }
      ```
    - ë‚´ë¶€ ë™ì‘: DiceService.play â†’ GameWalletService.require_and_consume_token â†’ VaultService.record_game_play_earn_event (payout_raw.reward_amount ì‚¬ìš©) â†’ RewardService.deliver (trial vault ë¼ìš°íŒ… í”Œë˜ê·¸ì— ë”°ë¼ ë¶„ê¸°).
- Dice Status
  - `GET /api/dice/status`
    - Response JSON ì˜ˆì‹œ:
      ```json
      {
        "config_id": 1,
        "name": "Peak Dice 202601",
        "max_daily_plays": 0,
        "today_plays": 0,
        "remaining_plays": 0,
        "token_type": "DICE_TOKEN",
        "token_balance": 5,
        "feature_type": "DICE"
      }
      ```

### 4-10. VaultProgram.config_json í‚¤ ìŠ¤í‚¤ë§ˆ (ê¶Œì¥ì•ˆ, ìµœì†Œ ìˆ˜ì •)
Vault2 ê¸°ë³¸ í”„ë¡œê·¸ë¨(`DEFAULT_PROGRAM_KEY=NEW_MEMBER_VAULT`)ì˜ config_jsonì— ì•„ë˜ í‚¤ë¥¼ ì‚¬ìš©í•´ ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥/ë¡œë“œí•œë‹¤.

```json
{
  "probability": {
    "DICE": {"p_win": 0.35, "p_draw": 0.10, "p_lose": 0.55}
  },
  "game_earn_config": {
    "DICE": {"WIN": 1400, "DRAW": -800, "LOSE": -1100}
  },
  "caps": {
    "DICE": {"daily_gain": 20000, "daily_plays": 30}
  },
  "eligibility": {
    "tags": {"blocklist": ["Blacklist"]}
  },
  "accrual_multiplier": 1.0
}
```
- ì ìš© ìˆœì„œ(ê¸°ì¡´ ì½”ë“œ ì¤€ìˆ˜): VaultService.record_game_play_earn_eventëŠ” `game_earn_config` â†’ payout_raw.reward_amount â†’ fallback(200/-50/0) ìˆœì„œë¡œ ê¸ˆì•¡ì„ ê²°ì •.
- í™•ë¥ (p_win/p_draw/p_lose)ì€ DiceService ì´ë²¤íŠ¸ ë¶„ê¸°ì—ì„œ ì½ì–´ ê°€ì¤‘ì¹˜ ëœë¤ì— ì ìš©.
- caps.daily_gain/daily_playsëŠ” ì´ë²¤íŠ¸ ëª¨ë“œ ì ë¦½/í”Œë ˆì´ ì „ ê²€ì¦ì— ì‚¬ìš©(ì´ˆê³¼ ì‹œ í´ë¨í”„ ë˜ëŠ” ì°¨ë‹¨).
- eligibility.tags.blocklistëŠ” AdminUserProfile.tags ê²€ì‚¬ì— ì‚¬ìš©.

## 5. ìš´ì˜ íŒŒë¼ë¯¸í„°(ì´ˆê¸° ê¶Œì¥ê°’)
- í”¼í¬íƒ€ì„: 30ë¶„
- ëŒ€ìƒì:
  - ìµœê·¼ 14ì¼ ì¶©ì „ 1íšŒ ì´ìƒ
  - ëˆ„ì  30,000ì› ì´ìƒ
  - (ê°€ëŠ¥í•˜ë©´) ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°ëŠ” â€œ30ë§Œì› ì¶©ì „â€ ë‹¨ì¼ ì¡°ê±´
- í”Œë ˆì´ ì¡°ê±´: 30íšŒ
- ìŠ¤í…Œì´í¬:
  - ì ê¸ˆ ì§€ê¸‰ 20,000
  - WIN/LOSE ì˜ˆì‹œ: +1,400 / -1,100 (ë˜ëŠ” +2,000 / -2,000)
- ìƒí•œ:
  - 1ì¼ 1íšŒ ì°¸ì—¬(ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° ê¸°ì¤€)
  - 1ì¼ ìµœëŒ€ í”Œë ˆì´ 30íšŒ
  - 1ì¼ ìµœëŒ€ ìˆœì¦ +20,000

## 6. ë¦¬ìŠ¤í¬ & ë°©ì–´
- â€œê½ë¨¸ë‹ˆ í‹°ì¼“ ë³´ìœ ìâ€ê°€ ì´ë²¤íŠ¸ ë³´ë„ˆìŠ¤ë¥¼ ë¨¹ëŠ” ë¬¸ì œ
  - í•´ê²°: í‹°ì¼“ ë³´ìœ  ì—¬ë¶€ê°€ ì•„ë‹ˆë¼ **ì¶©ì „/ì…ê¸ˆ ë°ì´í„° ê¸°ë°˜**ìœ¼ë¡œ eligible ì»·
  - TRIAL ì œì™¸ëŠ” ê°€ëŠ¥(ì™„ì „ ë¬´ë£Œ/í”„ë¡œëª¨ êµ¬ë¶„ì€ í˜„ì¬ í•œê³„)
- ë¹„ìš© í­ì£¼
  - ìƒí•œ(íšŸìˆ˜/ìˆœì¦) + ì ê¸ˆ/ì¡°ê±´ë¶€ ì¶œê¸ˆ + ëŒ€ìƒì ì»·
- ì‹ ë¢°/ì—¬ë¡ 
  - ì´ë²¤íŠ¸ ëª¨ë“œì˜ íŒŒë¼ë¯¸í„°(í™•ë¥ /í˜ì´í…Œì´ë¸”)ëŠ” ìš´ì˜ ë³€ê²½ ì´ë ¥ì´ ë‚¨ë„ë¡ ê´€ë¦¬(ì–´ë“œë¯¼ ê°ì‚¬ ë¡œê·¸ ê¶Œì¥)

## 7. ëª¨ë‹ˆí„°ë§/ì§€í‘œ
- ì°¸ì—¬ì ìˆ˜(eligible ì¤‘ ì‹¤ì œ í”Œë ˆì´)
- 30ë¶„ í”¼í¬íƒ€ì„ ë™ì‹œì ‘ì†/í”Œë ˆì´ ìˆ˜
- 1ì¸ í‰ê·  í”Œë ˆì´ ìˆ˜
- 1ì¸ í‰ê·  ìˆœì¦(ì ê¸ˆ ì”ê³  ë³€ë™)
- ì¶œê¸ˆ í•´ì œìœ¨(ì¡°ê±´ ë‹¬ì„±ë¥ )
- CS ì´ìŠˆ(â€œì™œ ì¶œê¸ˆì´ ì•ˆ ë˜ëƒ/ì¡°ê±´ì´ ë­ëƒâ€)

## 8. ë¡¤ë°± í”Œëœ
- ì¦‰ì‹œ ì¤‘ë‹¨:
  - Vault ë°°ìœ¨ OFF
  - ì´ë²¤íŠ¸ ëª¨ë“œ ì§„ì… ì°¨ë‹¨
- ì •ì‚°:
  - ì§„í–‰ ì¤‘ ìœ ì €ì˜ ìŠ¤í…Œì´í¬/ì ê¸ˆ ì”ê³ ëŠ” â€œì •ì±…ì— ë”°ë¼â€ ìœ ì§€/íšŒìˆ˜/ë¶€ë¶„ í™˜ê¸‰(ì‚¬ì „ ê³ ì§€ í•„ìš”)

---

## 9. ì—”í„°í”„ë¼ì´ì¦ˆ í’ˆì§ˆ/ìš´ì˜ ê¸°ì¤€ ì ê²€
- **ì„±ëŠ¥/ì§€ì—°**: `POST /api/dice/play` P99 < 200ms (ìºì‹œ ì—†ì´), DB ë‹¨ì¼ ì½ê¸°/ì“°ê¸° O(1) ìœ ì§€. Vault accrual ë°°ì¹˜ëŠ” ì—†ëŠ” êµ¬ì¡° ìœ ì§€.
- **ê³ ê°€ìš©ì„±**: ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„°(config_json) ë³€ê²½ ì‹œ ë¬´ì¤‘ë‹¨(í•« ë¦¬ë¡œë“œ). ì¥ì•  ì‹œ ê¸°ë³¸ í™•ë¥ /í˜ì´í…Œì´ë¸”ë¡œ í´ë°±í•˜ë„ë¡ ì„œë²„ ë””í´íŠ¸ ìœ ì§€.
- **ì¶”ì ì„±/ê°ì‚¬**: Admin íŒŒë¼ë¯¸í„° ë³€ê²½ ì‹œ `AdminAuditLog`ì— before/after + actor ê¸°ë¡. í™•ë¥ /í˜ì´í…Œì´ë¸”/ìƒí•œ ëª¨ë‘ í¬í•¨.
- **ë³´ì•ˆ**: Admin ì—”ë“œí¬ì¸íŠ¸ëŠ” ê´€ë¦¬ì í† í° + ì—­í•  ê²€ì¦. ëŒ€ìƒì/ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ëŠ” PII ìµœì†Œ ë…¸ì¶œ(í•„ìš” ì‹œ user_idë§Œ).
- **ë°ì´í„° ë¬´ê²°ì„±**: VaultEarnEventëŠ” earn_event_id ë©±ë“±í‚¤ë¡œ ì¤‘ë³µ ë°©ì§€. VaultStatus.progress_json ìˆ˜ì • ì‹œ íŠ¸ëœì­ì…˜ ë¬¶ê¸°.

## 10. í…ŒìŠ¤íŠ¸/ê²€ì¦ ë§¤íŠ¸ë¦­ìŠ¤ (í•„ìˆ˜)
- **ë‹¨ìœ„**: DiceService ì´ë²¤íŠ¸ ë¶„ê¸°(í™•ë¥  í•©=1, ê°€ì¤‘ì¹˜ ì ìš©), VaultService.record_game_play_earn_event ê¸ˆì•¡/ë°°ìœ¨/ìƒí•œ í´ë¨í”„, blacklist í´ë°±.
- **ì‹œë®¬ë ˆì´ì…˜**: 10k í”Œë ˆì´ ëª¬í…Œì¹´ë¥¼ë¡œ â†’ í‰ê·  ì”ê³ (ëª©í‘œ 14kÂ±500) í™•ì¸, caps.daily_gain/daily_plays ì ìš© ì—¬ë¶€ ê²€ì¦.
- **í†µí•©**: `POST /api/dice/play` â†’ VaultEarnEvent ìƒì„±, vault_locked_balance ë³€ë™, GameWallet í† í° ì°¨ê°, TRIAL ì œì™¸ ì‹œ plays_done ë¯¸ì¦ê°€.
- **í”„ë¡ íŠ¸ E2E**: í”¼í¬íƒ€ì„ íƒ€ì´ë¨¸ í‘œì‹œ, ìŠ¤í…Œì´í¬ 0 ì§„ì… ì°¨ë‹¨, ìŒìˆ˜ ì ë¦½ ì‹œ VaultAccrualModal ì°¨ê° ë¬¸êµ¬ ë…¸ì¶œ, ì–´ë“œë¯¼ ì„¤ì • ì €ì¥/ë¡œë“œ UI.
- **íšŒê·€**: ê¸°ì¡´ DICE ì¼ë°˜ ëª¨ë“œ(ì´ë²¤íŠ¸ ë¹„í™œì„±) ì •ìƒ ë™ì‘, Roulette/ë‹¤ë¥¸ ê²Œì„ì— ì˜í–¥ ì—†ëŠ”ì§€ ìŠ¤ëª¨í¬.

## 11. ë°°í¬/ë¡¤ì•„ì›ƒ ì „ëµ
- **í”Œë˜ê·¸**: `enable_vault_game_earn_events`(env) + `config_json.enable_game_earn_events`(DB) ë‘˜ ë‹¤ ì¼œì•¼ ì ë¦½ í™œì„±. ì´ë²¤íŠ¸ ëª¨ë“œ ìŠ¤ìœ„ì¹˜ëŠ” config_json.probability/game_earn_config ìœ ë¬´ë¡œ ê²°ì •.
- **ì ì§„ ë¡¤ì•„ì›ƒ**: caps.daily_playsë¥¼ ë‚®ê²Œ(ì˜ˆ: 5) ì‹œì‘ â†’ 30ìœ¼ë¡œ í™•ëŒ€. ìƒí•œì„ ë‚®ê²Œ ì‹œì‘í•´ ì†ì‹¤ ì¶”ì´ë¥¼ ê´€ì°°.
- **ë¡¤ë°± ìŠ¤ìœ„ì¹˜**: config_json.probability ë¹„ì›€ + game_earn_config ë¹„ì›€ â†’ ê¸°ë³¸ ëª¨ë“œ ë³µê·€. ë˜ëŠ” enable_vault_game_earn_events ë„ê¸°.

## 12. ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ & ëŒ€ì‘
- **VaultEarnEvent ì¤‘ë³µ/DB Lock**: IntegrityError ë°œìƒ ì‹œ 0 ë°˜í™˜(í˜„í–‰), ë¡œê·¸ ë‚¨ê¹€. ì¬ì‹œë„ í•„ìš” ì—†ìŒ.
- **config_json íŒŒì‹± ì‹¤íŒ¨**: fallback(ê¸°ë³¸ í™•ë¥ /í˜ì´í…Œì´ë¸”/ë°°ìœ¨=1.0)ë¡œ ì•ˆì „ í´ë°±, Admin Alert ë°œì†¡ ê¶Œì¥.
- **ìƒí•œ ê³„ì‚° ì˜¤ë¥˜**: caps ì ìš© ì „í›„ ë¡œê¹…ìœ¼ë¡œ ì›ì¸ ì¶”ì . ìƒí•œ ë„ë‹¬ ì‹œ ì ë¦½ 0 í´ë¨í”„ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ìœ ì§€.
- **RNG ê³ ì¥/ì‹œë“œ ë¬¸ì œ**: random.choices() ì‹œë“œ ê³ ì • í…ŒìŠ¤íŠ¸ë¥¼ CIì— í¬í•¨, ìš´ì˜ì—ì„œëŠ” ì‹œë“œ ë¯¸ê³ ì •.

## 13. ë°ì´í„°/ì„¤ì • ê´€ë¦¬
- **DB ë§ˆì´ê·¸ë ˆì´ì…˜**: ì—†ìŒ(ê¸°ì¡´ DiceConfig/Vault2 í™œìš©). config_json ìŠ¤í‚¤ë§ˆëŠ” JSON í™•ì¥ í•„ë“œë¡œ í›„ë°© í˜¸í™˜.
- **ë°±í•„/ì‹œë“œ**: ê¸°ì¡´ DiceConfig ìœ ì§€, ì´ë²¤íŠ¸ ì „ìš© ì„¤ì •ì€ ì‹ ê·œ ë ˆì½”ë“œ ì¶”ê°€(activateë¡œ ìŠ¤ìœ„ì¹­). VaultStatus.progress_jsonì€ ì´ë²¤íŠ¸ ì‹œì‘ ì‹œ ì´ˆê¸°í™”.
- **ë²„ì „ ê´€ë¦¬**: config_jsonì— `version` í•„ë“œ ì˜µì…˜(ì˜ˆ: `"version": 1`)ì„ ë‘ì–´ íŒŒë¼ë¯¸í„° ì²´ì¸ì§€ íŠ¸ë˜í‚¹ ê°€ëŠ¥.

## 14. ê°ì‚¬ ë¡œê·¸ ìŠ¤í‚¤ë§ˆ ì ìš© ê°€ì´ë“œ
- ìŠ¤í‚¤ë§ˆ: [app/models/admin_audit_log.py](app/models/admin_audit_log.py)
- ì œì•ˆ í•„ë“œ ê°’
  - `action`: `UPDATE_CONFIG`, `UPDATE_PROBABILITY`, `UPDATE_CAPS`, `TOGGLE_EVENT_MODE`
  - `target_type`: `VaultProgram` (config_json ë³€ê²½), `DiceConfig` (ë³´ìƒ ê¸ˆì•¡ ë³€ê²½)
  - `target_id`: program.id ë˜ëŠ” dice_config.id ë¬¸ìì—´
  - `before_json`/`after_json`: ë³€ê²½ëœ keyë§Œ ìµœì†Œ ì €ì¥ (ì˜ˆ: `{"probability":{"DICE":{"p_win":0.35}}}`)
- ìµœì†Œ ìˆ˜ì • ë°©ì•ˆ: ê¸°ì¡´ í…Œì´ë¸” ê·¸ëŒ€ë¡œ ì‚¬ìš©, Admin ì„œë¹„ìŠ¤/í•¸ë“¤ëŸ¬ì—ì„œ ìœ„ ê°’ìœ¼ë¡œ insertë§Œ ì¶”ê°€.

### 14-1. ê°ì‚¬ ë¡œê·¸ ì‚½ì… í¬ì¸íŠ¸ (ì œì•ˆ)
- [app/services/admin_dice_service.py](app/services/admin_dice_service.py)
  - `create_config`, `update_config`, `toggle_active` ì¢…ë£Œ ì§í›„ commit ì„±ê³µ ì‹œ AdminAuditLog ì‚½ì….
  - before_json: ë³€ê²½ ì „ DiceConfig í•„ë“œ ìŠ¤ëƒ…ìƒ·(í•´ë‹¹ í•„ë“œë§Œ). after_json: ë³€ê²½ í›„ í•„ë“œ.
  - action ì˜ˆì‹œ: `UPDATE_CONFIG` (create/update), `TOGGLE_EVENT_MODE` (is_active í† ê¸€).
  - target_type=`DiceConfig`, target_id=str(config.id).
- (ì„ íƒ) VaultProgram config_json ë³€ê²½ í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“¤ ê²½ìš° ë™ì¼ íŒ¨í„´ ì ìš©.

## 15. ì•ŒëŒ ê¸°ì¤€ ë° ëŒ€ì‹œë³´ë“œ ì—°ë™
- **ì§€ì—°**: `POST /api/dice/play` P99 > 200ms (5ë¶„ ì—°ì†) ì•ŒëŒ. ë©”íŠ¸ë¦­: HTTP server duration histogram.
- **ì˜¤ë¥˜ìœ¨**: 5xx ë¹„ìœ¨ > 1% (5ë¶„ í•©ì‚°) ì•ŒëŒ. 400ëŒ€ëŠ” ì œì™¸.
- **caps ì´ˆê³¼ ì‹œë„**: caps.daily_gain/daily_plays ì°¨ë‹¨ ì´ë²¤íŠ¸ê°€ ë¶„ë‹¹ 10ê±´ ì´ˆê³¼ ì‹œ ì•ŒëŒ(ì„¤ì • ì˜¤ë¥˜ ê°€ëŠ¥). ë©”íŠ¸ë¦­ ì†ŒìŠ¤: VaultService caps í´ë¨í”„ ë¡œê¹….
- **ëŒ€ì‹œë³´ë“œ**: API ì§€ì—°/ì˜¤ë¥˜ìœ¨, caps ì°¨ë‹¨ ì¹´ìš´í„°, VaultEarnEvent ì„±ê³µ/ì¤‘ë³µ ì¹´ìš´í„°, Dice play ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´í„°ë¥¼ ëª¨ë‘ ë…¸ì¶œ. ê¸°ë³¸ ë·°ì— ì´ë²¤íŠ¸ ëª¨ë“œ on/off í† ê¸€ ìƒíƒœ(config_json ì¡´ì¬ ì—¬ë¶€) í‘œê¸°.

### 15-1. ë©”íŠ¸ë¦­ ë„¤ì´ë° & ë¼ë²¨ ì„¤ê³„ (Prometheus ì˜ˆì‹œ)
- HTTP
  - `http_request_duration_seconds{handler="/api/dice/play",method="POST"}` (histogram)
  - `http_requests_total{handler="/api/dice/play",code="5xx"}`
- ê²Œì„/ê¸ˆê³ 
  - `dice_play_total{outcome="WIN|DRAW|LOSE", mode="EVENT|NORMAL"}`
  - `vault_earn_event_total{game="DICE", result="WIN|DRAW|LOSE", status="success|duplicate|skip"}`
  - `vault_caps_block_total{cap_type="daily_gain|daily_plays"}`
- ì„¤ì •/ìš´ì˜
  - `event_mode_active{program="NEW_MEMBER_VAULT"}` gauge (config_json.probability/game_earn_config ì¡´ì¬ ì—¬ë¶€ 0/1)
  - `config_change_total{target="VaultProgram|DiceConfig", action="UPDATE_CONFIG|UPDATE_PROBABILITY|TOGGLE_EVENT_MODE"}`

### 15-2. ëŒ€ì‹œë³´ë“œ íŒ¨ë„ ìŠ¤ì¼€ì¹˜
- Latency: P50/P95/P99 for `/api/dice/play` (line), ì˜¤ë¥˜ìœ¨(5xx %) stacked bar.
- Event Mode ìƒíƒœ: gauge (0/1), ìµœê·¼ config ë³€ê²½ ë¡œê·¸ í…Œì´ë¸”(beforeâ†’after diff).
- ê²Œì„ ì§€í‘œ: outcomeë³„ dice_play_total stacked bar; vault_earn_event_total success vs duplicate.
- Caps: vault_caps_block_total ì‹œê³„ì—´(ì¡°ê±´ ì´ˆê³¼ ì‹œ ìŠ¤íŒŒì´í¬ ê°ì§€), ì¼ë³„ caps ì°¨ë‹¨ í•©ê³„ í‘œ.
- ì•ŒëŒ ìƒíƒœ: ìµœê·¼ firing alerts ë¦¬ìŠ¤íŠ¸ (latency, error_rate, caps_block).

## ë¶€ë¡ A. ê´€ë ¨ ì½”ë“œ(ì°¸ì¡°)
- ê¸ˆê³  ê²Œì„ ì ë¦½/ì°¨ê°: `VaultService.record_game_earn_event()`
- ë°°ìœ¨: `VaultService.vault_accrual_multiplier()`
- ëˆ„ì  ì…ê¸ˆ: `ExternalRankingData.deposit_amount`
- ìµœê·¼ ì¶©ì „: `UserActivity.last_charge_at` (external_ranking_data ê°±ì‹  ê¸°ë°˜)
- TRIAL ì‚¬ìš© ì—¬ë¶€: `GameWalletService.require_and_consume_token()` â†’ `consumed_trial`

---

## 15. êµ¬í˜„ ìƒíƒœ ì²´í¬ë¦¬ìŠ¤íŠ¸ (Implementation Checklist)

### Phase 1: Backend Core (Dice/Vault Logic)
- [/] `VaultProgram` ëª¨ë¸/Config ìŠ¤í‚¤ë§ˆ í™•ì¥ (defaults)
- [x] `DiceService` ì´ë²¤íŠ¸ ë¶„ê¸° ë¡œì§ êµ¬í˜„ (í™•ë¥ , ìƒíƒœê°’)
- [x] `VaultService` ì ë¦½ ë¡œì§ ë³´ê°• (ì´ë²¤íŠ¸ ëª¨ë“œ, í˜ì´í…Œì´ë¸”)
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/services/test_dice_service.py` -> `test_dice_event_integration.py`)

### Phase 2: Admin Operations
- [x] Admin API Endpoint êµ¬í˜„ (`admin_dice` update)
- [x] Admin UI (`DiceConfigPage`) í™•ì¥ - ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„° í¼
- [x] Admin Audit Log ì—°ë™

### Phase 3: User Experience
- [x] Frontend UI (Event Banner, Timer, Streak)
- [x] `DicePage` UI Update (Event Banner, Timer, State)
- [x] Result Modal Logic (Event Accrual Display)
- [ ] State Sync (Eligible, Progress)

### Phase 4: Verification & Ops
- [ ] E2E Test (Scenario)
- [ ] Grafana Dashboard / Alerts Setup
