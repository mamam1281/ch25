```markdown
# 2025-12-20 개발 로그

## 목표
- “오늘 스탬프”를 **진짜 일일 체크인**으로 고정: `period_key=today.isoformat()` 인 경우만 `today.stamped=true`.
- 로컬에서 `pytest`가 import 단계에서 막히지 않도록(기존 `jwt` 모듈 누락) 개발환경 정리.

## 백엔드 (시즌패스)
- “오늘 스탬프” 판정 로직 변경
  - `get_status()`에서 `today.stamped`는 **오늘 날짜의 일일 체크인 키(`YYYY-MM-DD`)로 찍힌 스탬프가 있을 때만** true.
  - 다른 기능 스탬프(예: `INTERNAL_WIN_50`, TOP10 등)는 오늘 스탬프 완료로 간주하지 않음.
- 일일 체크인 중복 방지
  - `add_stamp()`에서 `period_key == today.isoformat()` 인 요청은 **하루 1회만 허용**.
  - 동일 일자 2회 호출 시 `400`으로 차단(예: `ALREADY_STAMPED_TODAY`).

## 런타임 검증 (Docker)
- 변경 코드가 컨테이너에 반영되지 않은 상태를 발견하여 백엔드 재빌드/재시작 후 재검증.
  - 사용 명령: `docker compose build backend` → `docker compose up -d backend`
- 검증 결과
  - `POST /api/season-pass/stamp` 호출 전/후 `today.stamped`가 `false → true`로 정상 토글.
  - INTERNAL 스탬프만 DB에 주입한 경우 `today.stamped`는 `false` 유지(일일 체크인 키가 아니면 미완료).
  - 일일 체크인 스탬프를 같은 날 2번 호출하면 2번째는 `400`으로 차단.

## 로컬 개발환경 (pytest 실행 가능 상태로 복구)
- 기존 이슈
  - 로컬 테스트 실행 시 `ModuleNotFoundError: No module named 'jwt'` 로 인해 `pytest`가 시작 단계에서 중단.
  - 추가로 Python 3.13 + `sqlalchemy==2.0.25` 조합에서 타입 관련 AssertionError가 발생.
- 조치
  - Python 3.11 기반 가상환경 `.venv311` 생성 후 `requirements.txt` 설치.
  - `PyJWT` import 및 `pytest` 실행 확인.
- 결과
  - `pytest`가 정상적으로 실행됨(단, 1개 테스트는 데이터 시드 전제 불일치로 실패).
    - 예: `tests/test_auth_token.py`에서 `user_id=101`이 테스트 DB에 존재하지 않아 실패.

## 메모 / 다음 액션
- 오늘 스탬프가 “상태만 표시”로 남아있다면, UI에서 일일 체크인을 트리거하는 버튼/콜사이트 추가 여부를 제품 결정 필요.
- 로컬 테스트 1개 실패는 테스트 픽스처/시드 정책을 정리해서 안정화 가능.

```