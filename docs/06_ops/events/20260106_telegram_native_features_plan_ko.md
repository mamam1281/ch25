# 📋 텔레그램 네이티브 기능 도입 계획 (Telegram Native Features Integration Plan)

**작성일**: 2026-01-06  
**상태**: 계획 (Initial Plan)  
**작성자**: Antigravity Agent  
**문서 위치**: `docs/06_ops/events/20260106_telegram_native_features_plan_ko.md`

---

## 1. 개요 (Overview)
본 문서는 텔레그램 웹앱(TWA)의 네이티브 기능을 활용하여 앱의 바이럴 확산(Viral)과 재미 요소(Fun Factor)를 강화하기 위한 기술 도입 계획서입니다. 특히 **스토리 공유** 기능을 통한 유입 증대와 **가속도 센서**를 활용한 인터랙티브 경험에 초점을 맞춥니다.

---

## 2. 텔레그램 스토리 공유 (Share to Story)

### 2.1 기능 정의
앱 내의 게임 결과, 획득한 아이템, 랭킹 등의 성과 이미지를 생성하여 사용자의 텔레그램 '스토리'에 즉시 업로드할 수 있는 편집 화면을 호출합니다.

### 2.2 도입 목적
*   **Viral Marketing**: 사용자의 자발적인 성과 공유를 통해 자연스럽게 지인들에게 앱을 노출.
*   **Acquisition**: 스토리 하단 위젯(Link Widget)에 리퍼럴 코드가 포함된 진입 링크를 심어 신규 유저 유입 유도.
*   **Retention**: 자신의 성과를 자랑(Share Score)하고 싶은 욕구를 충족시켜 게임 몰입도 증대.

### 2.3 활용 시나리오 (Use Cases)
1.  **레벨업/승급 달성 시**:
    *   *"축하합니다! Silver 등급 달성!"* 화려한 축하 카드 노출 및 [스토리에 자랑하기] 버튼 활성화.
    *   공유 시 캡션: "나 실버 등급 찍음 ㅋㅋ 같이 하실 분?"
2.  **잭팟/대박 당첨 시**:
    *   1,000 포인트 이상 고액 당첨 시 자동으로 인증샷 카드 생성.
    *   공유 위젯: "💰 나처럼 잭팟 터트리기 (클릭)" -> 앱 실행 링크 연결.
3.  **팀 배틀 승리**:
    *   소속 팀 승리 시 팀 엠블럼이 박힌 승리 카드 공유.

### 2.4 기술 구현 계획 (Implementation)
*   **API**: `web_app_share_to_story`
*   **파라미터 구성**:
    *   `media_url`: 서버에서 동적으로 생성한 이미지 URL (Open Graph 이미지와 유사).
    *   `text`: 기본 캡션 멘트.
    *   `widget_link`: `{ url: "https://t.me/MyBot/App?startapp=ref_123", name: "게임 하러가기" }`.
*   **선결 과제**:
    *   동적 이미지 생성 서버(또는 Cloudinary 등) 연동 필요.
    *   프론트엔드에서 캡쳐(html2canvas) 후 업로드 로직 검토.

---

## 3. 흔들어서 기능 실행 (Shake Interaction)

### 3.1 기능 정의
모바일 기기의 가속도 센서(Accelerometer) 데이터를 실시간으로 감지하여, 사용자가 기기를 흔드는 동작(Shake Gesture)을 했을 때 특정 이벤트를 트리거합니다.

### 3.2 도입 목적
*   **Fun Factor**: 단순 터치 인터페이스를 넘어선 물리적 상호작용으로 '손맛'과 재미 제공.
*   **Hidden Reward**: 숨겨진 꿀통(Easter Egg)을 찾는 듯한 탐험 경험 제공.

### 3.3 활용 시나리오 (Use Cases)
1.  **랜덤 보너스 상자 (Random Box)**:
    *   특정 페이지(예: 로비, 상점)에 "폰을 흔들어보세요!" 힌트 문구 표시.
    *   흔들면 상자가 덜거덕거리는 애니메이션 + 햅틱 피드백 후 오픈 -> 소량의 포인트나 티켓 지급.
2.  **주사위/룰렛 미니게임 배팅**:
    *   '굴리기' 버튼을 누르는 대신 실제 폰을 흔들어 주사위를 던지는 연출.
    *   흔드는 강도에 따라 주사위가 더 강하게 튀는 등 시각적 피드백 강화.
3.  **새로고침/리셋**:
    *   미션 목록이나 상점 상품 목록을 흔들어서 새로고침(Shake to Refresh).

### 3.4 기술 구현 계획 (Implementation)
*   **API**: `web_app_start_accelerometer`, `web_app_stop_accelerometer`
*   **감지 로직**:
    *   `accelerometer_changed` 이벤트를 통해 주기적으로(예: 200ms) x, y, z 가속도 값 수신.
    *   특정 임계값(Threshold) 이상의 가속도 변화량이 감지되면 'Shake'로 판정.
*   **주의사항**:
    *   배터리 소모 최적화를 위해 해당 페이지 진입 시에만 센서를 켜고(`start`), 이탈 시 반드시 끔(`stop`).
    *   센서 미지원 기기 예외 처리 필수.

---

## 4. 일정 및 리소스 (Timeline & Resources)
*   **우선순위**: 스토리 공유(High) > 셰이크 기능(Medium)
*   **예상 소요 시간**:
    *   스토리 공유: UI/이미지 템플릿 제작(1MD) + 연동 개발(0.5MD)
    *   셰이크 기능: 센서 로직 구현 및 튜닝(1MD) + 인터랙션 UI(0.5MD)
