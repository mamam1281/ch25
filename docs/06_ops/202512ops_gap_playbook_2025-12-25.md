# 운영 공백 대비 액션 플랜 (2025-12-25 기준)

- 목적: 12/25~1/7 중 **실제 공백일 1/1~1/2, 1/6~1/7**에 대비해 최소 동작으로 리텐션을 유지하고, 데이터 초기화/금고 수동 지급 정책을 안전하게 처리한다.
- 범위: 서버가 일시 중단된 상태에서의 사전 준비, 공백 기간 대응, 재가동 전 초기화/백업 절차.
- 지급 정책: 금고 해금 금액은 **운영/외부 수동 지급**(게임 내 자동 지급 없음)으로 확정.

## 1) 운영 공백 대비
- [ ] 공지/배너: 랭킹 스냅샷 정지 안내 + 정지 기간/재개 시각 명시.
- [ ] 런북 링크: 비상 연락 맥락과 연락 수단(슬랙/전화) 문서화.
- [ ] 로그 확인 경로 공유: 백엔드/프론트 로그 위치, 크론/잡 상태 확인법.
- [ ] 단기 모니터링: 서버 중단 안내가 정상 노출되는지 한 번 확인.

### 참고 명령어
- 배너/공지 JSON 배포 예시(경로/포맷은 실제 FE 계약에 맞게 조정):
  ```bash
  # 예) public/maintenance.json 업데이트 후 프론트가 주기 fetch
  echo '{"message":"랭킹/정산 일시 중지: 1/1~1/2, 1/6~1/7"}' > public/maintenance.json
  ```
- 기본 로그 확인(컨테이너 이름/서비스 확인 후 실행):
  ```bash
  docker compose logs backend --since=10m
  docker compose logs frontend --since=10m
  ```

## 2) 데이터 초기화 플랜 (시즌 종료 이후)
보존 대상: 가입/닉네임/가입일자/최근활동일. 초기화 대상: 랭킹/플레이로그/잔여 티켓/XP/시즌패스 경험치 등.

- [x] 백업 먼저: 전체 DB 덤프 생성 후 안전한 스토리지에 보관.
- [x] 초기화 스크립트 작성: 보존 컬럼만 남기고 나머지 테이블 truncate/reset. (드라이런/비활성 상태에서 검증)
- [x] 초기화 실행 순서 정리: 백업 확인 → 초기화 스크립트 실행 → 샘플 계정으로 검증 → 서버 재가동.

### 현재 DB 스펙 (12/25 기준)
- MySQL 8.0 컨테이너 `xmas-db`, DB `xmas_event`, 사용자 `xmasuser`, 비밀번호 `2wP?+!Etm8#Qv4Mn`.
- docker compose 위치: `/root/ch25`, 백업 보관 폴더: `/root/ch25/backups`.

### 완료 내역 (12/25 실행)
- 백업 생성: `/root/ch25/backups/backup_20251225_044008.sql` (~547K), `/root/ch25/backups/backup_20251225_044042.sql` (~95K).
- 초기화: `ranking_daily`, `roulette_log`, `season_pass_progress` 등 시즌 데이터 테이블 truncate 후 카운트 0 확인.

### 재실행용 참고 명령어 (실 DB 정보 확인 후 실행)
- 백업(MySQL, 비밀번호 특수문자 주의 → `MYSQL_PWD` 사용):
  ```bash
  cd /root/ch25
  docker compose exec db env MYSQL_PWD='2wP?+!Etm8#Qv4Mn' mysqldump --no-tablespaces -uxmasuser -hlocalhost -Dxmas_event > backups/backup_$(date +%Y%m%d_%H%M%S).sql
  ```
- 특정 테이블 초기화 예시(실행 전 백업 필수):
  ```bash
  docker compose exec db env MYSQL_PWD='2wP?+!Etm8#Qv4Mn' mysql -uxmasuser -hlocalhost -Dxmas_event -e "TRUNCATE TABLE ranking_daily, roulette_log, season_pass_progress;"
  ```
  ※ 컬럼 단위 초기화가 필요하면 별도 UPDATE/DELETE 스크립트로 작성 후 검증.

## 3) 리텐션 이벤트 (12/25~1/1, 최소 운영) — 아이디어 확정 후 실행
- [ ] 출석 3회 미션: 12/25~12/31 사이 3회 접속 시 1/2 이후 금고에 예약 지급(수동 지급 명시).
- [ ] 짧은 미션 1개: "홈 배너 확인" 또는 "티켓0 모달 열람"만으로 참여 완료 처리(서버 중단 중이므로 로깅 최소화).
- [ ] 예약 보상 카테고리: 금액/포인트는 **수동 지급**으로만 약속하고, 지급일자를 공지(예: 1/2 또는 1/8 일괄).
- [ ] 공지/푸시 타이밍: 12/25, 12/28, 12/31 3회로 제한. 카피에 공백일(1/1~1/2, 1/6~1/7)과 수동 지급을 명확히 표기.

### 안내 카피 샘플
- "서버 점검: 1/1~1/2, 1/6~1/7 랭킹 정산 일시 중지. 12/25~12/31 체크인 3회면 1/2 이후 금고에 예약 지급(수동 지급)."

## 4) 금고 지급 경로 고지
- [x] FE/운영 카피에 "수동/외부 지급" 명시, 자동 지급 기대감 차단.
  - cc 코인: 전량 관리자 확인 후 지급(프론트 자동 수령/자동 정산 경로 제거).
  - 프론트 UI: cc 코인 자동 수령/자동 정산 노출 제거, '관리자 지급' 라벨/카피로만 표시.
  - 자동 지급/획득 차단 대상: XP 경험치, 내부 게임 티켓(룰렛티켓/주사위티켓/복권티켓).
- [ ] 운영 핸드북에 지급 절차(스프레드시트/외부 정산 시스템 입력 절차) 기록.
- [x] 해금 알림/모달에도 "수동 지급" 라벨 노출(자동 수령/정산 문구 제거, 관리자 지급 안내만 표시).

## 5) 리소스 제약 대응 (AI 토큰 부족)
- [ ] 먼저 문서/체크리스트 확정 → 개발/배포 작업은 토큰 확보 후 실행.
- [ ] 필요 커맨드/절차는 본 문서에 모두 적어두고, 실행은 공백기 이후에 순차 처리.

---
- 점검/재개 예정일: 1/1~1/2, 1/6~1/7 공백. 재개 시 알림과 함께 DB 초기화 상태, 금고 수동 지급 정책을 다시 공지.
